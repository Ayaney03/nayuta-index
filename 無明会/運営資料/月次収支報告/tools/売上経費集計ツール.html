<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁÑ°Êòé‰ºö Â£≤‰∏äÁµåË≤ªÈõÜË®à„ÉÑ„Éº„É´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Yu Gothic', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #f8f6f3 0%, #fff8dc 50%, #f5e6a3 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #f5e6a3 0%, #d4af37 50%, #b8860b 100%);
            color: #8b6914;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        .input-section {
            padding: 40px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
        }

        .output-section {
            padding: 40px;
            background: white;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #d4af37;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .upload-area {
            border: 2px dashed #d4af37;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #fff8dc;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #b8860b;
            background: #f5e6a3;
        }

        .upload-area input[type="file"] {
            border: none;
            background: transparent;
        }

        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .data-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: border-color 0.3s ease;
        }

        .data-item:hover {
            border-color: #d4af37;
        }

        .data-item label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            display: block;
        }

        .data-item input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .service-section {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .service-section h4 {
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .expense-item {
            margin-bottom: 15px;
        }

        .expense-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }

        .expense-item input, .expense-item select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .expense-section {
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-header h5 {
            margin: 0;
            font-size: 1em;
        }

        .add-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .add-btn:hover {
            background: #218838;
        }

        .expense-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .remove-btn:hover {
            background: #c82333;
        }

        .labor-expense-item, .other-expense-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .calculate-btn {
            background: linear-gradient(135deg, #d4af37 0%, #b8860b 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
        }

        .summary-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #d4af37;
            padding-bottom: 8px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .summary-item:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 1.1em;
            color: #2c3e50;
        }

        .summary-item.total {
            background: #d4af37;
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
        }

        .transfer-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
        }

        .transfer-btn:hover {
            background: #218838;
        }

        .csv-preview {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
        }

        .help-text {
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä ÁÑ°Êòé‰ºö Â£≤‰∏äÁµåË≤ªÈõÜË®à„ÉÑ„Éº„É´</h1>
            <p>Ë§áÊï∞„Éá„Éº„Çø„ÇΩ„Éº„Çπ„Åã„ÇâÂ£≤‰∏ä„ÉªÁµåË≤ª„ÇíËá™ÂãïÈõÜË®à„Åó„Åæ„Åô</p>
        </div>
        
        <div class="content">
            <div class="input-section">
                <h2 class="section-title">üìù „Éá„Éº„ÇøÂÖ•Âäõ</h2>
                
                <!-- ÂØæË±°Âπ¥Êúà -->
                <div class="form-group">
                    <label>ÂØæË±°Âπ¥Êúà</label>
                    <div class="data-grid">
                        <div>
                            <label for="targetYear">Âπ¥</label>
                            <select id="targetYear" required>
                                <option value="">Âπ¥„ÇíÈÅ∏Êäû</option>
                            </select>
                        </div>
                        <div>
                            <label for="targetMonth">Êúà</label>
                            <select id="targetMonth" required>
                                <option value="">Êúà„ÇíÈÅ∏Êäû</option>
                                <option value="1">1Êúà</option>
                                <option value="2">2Êúà</option>
                                <option value="3">3Êúà</option>
                                <option value="4">4Êúà</option>
                                <option value="5">5Êúà</option>
                                <option value="6">6Êúà</option>
                                <option value="7">7Êúà</option>
                                <option value="8">8Êúà</option>
                                <option value="9">9Êúà</option>
                                <option value="10">10Êúà</option>
                                <option value="11">11Êúà</option>
                                <option value="12">12Êúà</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- „Çµ„Éº„Éì„ÇπÂà•Â£≤‰∏ä„Éá„Éº„ÇøÂÖ•Âäõ -->
                <div class="form-group">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">üí∞ „Çµ„Éº„Éì„ÇπÂà•Â£≤‰∏ä„Éá„Éº„Çø</h3>
                    
                    <!-- „Ç≥„Éü„É•„Éã„ÉÜ„Ç£Â£≤‰∏ä -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">üè¢ „Ç≥„Éü„É•„Éã„ÉÜ„Ç£</h4>
                        
                        <!-- ÊâãÂãïÂÖ•Âäõ„Çª„ÇØ„Ç∑„Éß„É≥ -->
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="communitySalesManual">„Ç≥„Éü„É•„Éã„ÉÜ„Ç£Â£≤‰∏äÈáëÈ°ç</label>
                                <input type="text" id="communitySalesManual" placeholder="0" value="0">
                                <div class="help-text">ÊúàÈ°ç„ÉªÂπ¥È°ç‰ºöÂì°„ÅÆÂêàË®àÂ£≤‰∏ä„ÇíÂÖ•Âäõ</div>
                            </div>
                            <div class="data-item">
                                <label for="communityCommissionExpense">Ê±∫Ê∏àÊâãÊï∞Êñô</label>
                                <input type="text" id="communityCommissionExpense" placeholder="0" value="0">
                                <div class="help-text">„Ç≥„Éü„É•„Éã„ÉÜ„Ç£Â£≤‰∏ä„ÅÆÊ±∫Ê∏àÊâãÊï∞Êñô</div>
                            </div>
                        </div>

                        <!-- ÂèÇËÄÉÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥ -->
                        <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; padding: 15px; margin-top: 15px;">
                            <h5 style="color: #6c757d; margin-bottom: 10px;">üìã ÂèÇËÄÉÊÉÖÂ†±ÔºàËá™ÂãïË®àÁÆóÔºâ</h5>
                            
                            <!-- ÊúàÈ°ç‰ºöÂì° -->
                            <div class="membership-section">
                                <h6 style="color: #2c3e50; margin-bottom: 10px;">üìÖ ÊúàÈ°ç‰ºöÂì°Ôºà2.2‰∏áÂÜÜÁ®éËæºÔºâ</h6>
                                <div class="data-grid">
                                    <div class="data-item">
                                        <label for="newMonthlyMembers">Êñ∞Ë¶èÂÖ•‰ºöËÄÖÊï∞</label>
                                        <input type="number" id="newMonthlyMembers" placeholder="0" value="0" min="0">
                                    </div>
                                    <div class="data-item">
                                        <label for="continuingMonthlyMembers">Á∂ôÁ∂öÊ±∫Ê∏àËÄÖÊï∞</label>
                                        <input type="number" id="continuingMonthlyMembers" placeholder="0" value="0" min="0">
                                    </div>
                                </div>
                                <div style="margin-top: 8px; font-size: 0.9em; color: #6c757d;">
                                    Ë®àÁÆóÁµêÊûú: <span id="monthlyMembersSalesCalc">¬•0</span>
                                </div>
                            </div>

                            <!-- Âπ¥È°ç‰ºöÂì° -->
                            <div class="membership-section">
                                <h6 style="color: #2c3e50; margin-bottom: 10px;">üìÖ Âπ¥È°ç‰ºöÂì°Ôºà22‰∏áÂÜÜÁ®éËæºÔºâ</h6>
                                <div class="data-grid">
                                    <div class="data-item">
                                        <label for="newYearlyMembers">Êñ∞Ë¶èÂÖ•‰ºöËÄÖÊï∞</label>
                                        <input type="number" id="newYearlyMembers" placeholder="0" value="0" min="0">
                                    </div>
                                    <div class="data-item">
                                        <label for="existingYearlyMembers">Âú®Á±çÂπ¥È°ç‰ºöÂì°Êï∞</label>
                                        <input type="number" id="existingYearlyMembers" placeholder="0" value="0" min="0">
                                    </div>
                                </div>
                                <div style="margin-top: 8px; font-size: 0.9em; color: #6c757d;">
                                    Ë®àÁÆóÁµêÊûú: <span id="yearlyMembersSalesCalc">¬•0</span>
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #e9ecef; font-weight: 600; color: #2c3e50;">
                                ÂêàË®à: <span id="totalMembersSalesCalc">¬•0</span>
                            </div>
                        </div>
                    </div>

                    <!-- noteÂ£≤‰∏ä„ÉªÁµåË≤ª -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">üìù note</h4>
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="noteSales">Â£≤‰∏äÈáëÈ°ç</label>
                                <input type="text" id="noteSales" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="noteCommissionExpense">Ê±∫Ê∏àÊâãÊï∞Êñô</label>
                                <input type="text" id="noteCommissionExpense" placeholder="0" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- ÂæπÂ∫ïÁ≤æÈÄ≤„Ç≥„Éº„ÇπÂ£≤‰∏ä„ÉªÁµåË≤ª -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">üî• ÂæπÂ∫ïÁ≤æÈÄ≤„Ç≥„Éº„Çπ</h4>
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="appSellSales">ÊåØËæºÂ£≤‰∏äÈáëÈ°ç</label>
                                <input type="text" id="appSellSales" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="appSellStaffExpense">„Çπ„Çø„ÉÉ„Éï„ÉªÊåáÂ∞éËÄÖ‰∫∫‰ª∂Ë≤ª</label>
                                <input type="text" id="appSellStaffExpense" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="appSellOtherExpense">„Åù„ÅÆ‰ªñÁµåË≤ª</label>
                                <input type="text" id="appSellOtherExpense" placeholder="0" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- NH„Éñ„Éº„Éà„Ç≠„É£„É≥„ÉóÂ£≤‰∏ä„ÉªÁµåË≤ª -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">üí™ NH„Éñ„Éº„Éà„Ç≠„É£„É≥„Éó</h4>
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="nhBootcampSales">Â£≤‰∏äÈáëÈ°ç</label>
                                <input type="text" id="nhBootcampSales" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="nhBootcampStaffExpense">„Çπ„Çø„ÉÉ„Éï„ÉªÊåáÂ∞éËÄÖ‰∫∫‰ª∂Ë≤ª</label>
                                <input type="text" id="nhBootcampStaffExpense" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="nhBootcampOtherExpense">„Åù„ÅÆ‰ªñÁµåË≤ª</label>
                                <input type="text" id="nhBootcampOtherExpense" placeholder="0" value="0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- „Çµ„Éº„Éì„ÇπÂà•ÁµåË≤ª„Éá„Éº„ÇøÂÖ•Âäõ -->
                <div class="form-group">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">üí∏ „Çµ„Éº„Éì„ÇπÂà•ÁµåË≤ª„Éá„Éº„Çø</h3>
                    
                    <!-- ÂæπÂ∫ïÁ≤æÈÄ≤„Ç≥„Éº„ÇπÁµåË≤ª -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">üìö ÂæπÂ∫ïÁ≤æÈÄ≤„Ç≥„Éº„ÇπÁµåË≤ª</h4>
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="appSellStaffExpense">„Çπ„Çø„ÉÉ„Éï„ÉªÊåáÂ∞éËÄÖ‰∫∫‰ª∂Ë≤ª</label>
                                <input type="text" id="appSellStaffExpense" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="appSellOtherExpense">„Åù„ÅÆ‰ªñÁµåË≤ª</label>
                                <input type="text" id="appSellOtherExpense" placeholder="0" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- NH„Éñ„Éº„Éà„Ç≠„É£„É≥„ÉóÁµåË≤ª -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">üöÄ NH„Éñ„Éº„Éà„Ç≠„É£„É≥„ÉóÁµåË≤ª</h4>
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="nhBootcampStaffExpense">„Çπ„Çø„ÉÉ„Éï„ÉªÊåáÂ∞éËÄÖ‰∫∫‰ª∂Ë≤ª</label>
                                <input type="text" id="nhBootcampStaffExpense" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="nhBootcampOtherExpense">„Åù„ÅÆ‰ªñÁµåË≤ª</label>
                                <input type="text" id="nhBootcampOtherExpense" placeholder="0" value="0">
                            </div>
                        </div>
                    </div>



                    <!-- ÂÖ±ÈÄöÁµåË≤ª -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">üè¢ ÂÖ±ÈÄöÁµåË≤ª</h4>
                        
                        <!-- ‰ºöÂ†¥Ë≤ª -->
                        <div class="expense-item">
                            <label for="venueExpense">‰ºöÂ†¥Ë≤ª</label>
                            <input type="text" id="venueExpense" placeholder="0" value="0">
                        </div>

                        <!-- ‰∫∫‰ª∂Ë≤ªÔºàÂãïÁöÑËøΩÂä†Ôºâ -->
                        <div class="expense-section">
                            <div class="section-header">
                                <h5 style="color: #2c3e50; margin-bottom: 10px;">üë• ‰∫∫‰ª∂Ë≤ª</h5>
                                <button type="button" class="add-btn" onclick="addLaborExpense()">‚ûï ‰∫∫‰ª∂Ë≤ªÈ†ÖÁõÆ„ÇíËøΩÂä†</button>
                            </div>
                            <div id="laborExpensesContainer">
                                <div class="expense-item labor-expense-item">
                                    <div class="expense-item-header">
                                        <label>‰∫∫‰ª∂Ë≤ªÈ†ÖÁõÆÂêç</label>
                                        <button type="button" class="remove-btn" onclick="removeLaborExpense(this)" style="display: none;">üóëÔ∏è</button>
                                    </div>
                                    <input type="text" class="labor-expense-label" value="‰∏ÄËà¨ÁöÑ‰∫∫‰ª∂Ë≤ª" placeholder="È†ÖÁõÆÂêç„ÇíÂÖ•Âäõ">
                                    <label>ÈáëÈ°ç</label>
                                    <input type="text" class="labor-expense-amount" placeholder="0" value="0">
                                </div>
                            </div>
                        </div>

                        <!-- „Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞Ë≤ª -->
                        <div class="expense-item">
                            <label for="marketingExpense">„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞Ë≤ªÔºàLINE„ÄÅX„ÄÅÂÆ¥Á≠âÔºâ</label>
                            <input type="text" id="marketingExpense" placeholder="0" value="0">
                        </div>

                        <!-- „Ç∑„Çπ„ÉÜ„É†Ë≤ª -->
                        <div class="expense-item">
                            <label for="systemExpense">„Ç∑„Çπ„ÉÜ„É†Ë≤ª</label>
                            <input type="text" id="systemExpense" placeholder="0" value="0">
                        </div>

                        <!-- „Åù„ÅÆ‰ªñÁµåË≤ªÔºàÂãïÁöÑËøΩÂä†Ôºâ -->
                        <div class="expense-section">
                            <div class="section-header">
                                <h5 style="color: #2c3e50; margin-bottom: 10px;">üìã „Åù„ÅÆ‰ªñÁµåË≤ª</h5>
                                <button type="button" class="add-btn" onclick="addOtherExpense()">‚ûï ÁµåË≤ªÈ†ÖÁõÆ„ÇíËøΩÂä†</button>
                            </div>
                            <div id="otherExpensesContainer">
                                <div class="expense-item other-expense-item">
                                    <div class="expense-item-header">
                                        <label>ÁµåË≤ªÈ†ÖÁõÆÂêç</label>
                                        <button type="button" class="remove-btn" onclick="removeOtherExpense(this)" style="display: none;">üóëÔ∏è</button>
                                    </div>
                                    <input type="text" class="other-expense-label" value="„Åù„ÅÆ‰ªñÁµåË≤ª" placeholder="È†ÖÁõÆÂêç„ÇíÂÖ•Âäõ">
                                    <label>ÈáëÈ°ç</label>
                                    <input type="text" class="other-expense-amount" placeholder="0" value="0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="button" class="calculate-btn" onclick="calculateTotal()">üìä ÈõÜË®àÂÆüË°å</button>
                <button type="button" class="test-btn" onclick="loadTestData()" style="background: #28a745; margin-top: 10px;">üß™ „ÉÜ„Çπ„Éà„Éá„Éº„ÇøË™≠„ÅøËæº„Åø</button>
            </div>

            <!-- „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàËß£Êûê„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="input-section" style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #e9ecef;">
                <h2 class="section-title">üìä „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàËß£Êûê</h2>
                
                <div class="form-group">
                    <label for="spreadsheetData">„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Éá„Éº„Çø„ÇíË≤º„Çä‰ªò„Åë</label>
                    <textarea id="spreadsheetData" placeholder="„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Åã„Çâ„Ç≥„Éî„Éº„Åó„Åü„Éá„Éº„Çø„Çí„Åì„Åì„Å´Ë≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ&#10;‰æãÔºö&#10;2025-07-12 17:43:22	Èà¥Êú®Êô∫Âºò	10tomo11yasu@gmail.com	NH„Éñ„Éº„Éà„Ç≠„É£„É≥„Éó ÂçäÂπ¥„Ç≥„Éº„Çπ„Éª„Éé„Éº„Éû„É´„Éó„É©„É≥	univapay	 ¬• 29,880 	‰∏ÄÂõûÊâï„ÅÑ" rows="8" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 6px; font-family: monospace; font-size: 0.9em;"></textarea>
                    <div class="help-text">„Çø„ÉñÂå∫Âàá„Çä„Åæ„Åü„ÅØ„Ç´„É≥„ÉûÂå∫Âàá„Çä„ÅÆ„Éá„Éº„Çø„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åô</div>
                </div>

                <div class="form-group">
                    <label for="dataType">„Éá„Éº„ÇøÂΩ¢Âºè</label>
                    <select id="dataType" style="width: 100%; padding: 8px; border: 2px solid #e9ecef; border-radius: 6px;">
                        <option value="auto">Ëá™ÂãïÂà§ÂÆö</option>
                        <option value="tab">„Çø„ÉñÂå∫Âàá„Çä</option>
                        <option value="comma">„Ç´„É≥„ÉûÂå∫Âàá„Çä</option>
                    </select>
                </div>

                <button id="analyzeBtn" style="background: #007bff; color: white; border: none; padding: 12px 25px; border-radius: 6px; font-size: 1em; cursor: pointer; width: 100%; margin-top: 15px; transition: background-color 0.2s ease;">üîç „Éá„Éº„Çø„ÇíËß£Êûê</button>
                
                <div id="analysisResult" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef; display: none;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">üìà Ëß£ÊûêÁµêÊûú</h4>
                    <div id="analysisContent"></div>
                    <button id="applyAnalysisBtn" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; font-size: 0.9em; cursor: pointer; margin-top: 10px;">‚úÖ Â£≤‰∏ä„Å´ÂèçÊò†</button>
                </div>
            </div>
            </div>

            <div class="output-section">
                <h2 class="section-title">üìã ÈõÜË®àÁµêÊûú</h2>
                
                <!-- „Çµ„Éº„Éì„ÇπÂà•Â£≤‰∏ä„Çµ„Éû„É™„Éº -->
                <div class="summary-card">
                    <h3>üí∞ „Çµ„Éº„Éì„ÇπÂà•Â£≤‰∏äÂÜÖË®≥</h3>
                    <div id="salesSummary">
                        <div class="summary-item">
                            <span>üè¢ „Ç≥„Éü„É•„Éã„ÉÜ„Ç£Â£≤‰∏ä</span>
                            <span id="communitySalesAmount">¬•0</span>
                        </div>
                        <div class="summary-item">
                            <span>üìù noteÂ£≤‰∏ä</span>
                            <span id="noteSalesAmount">¬•0</span>
                        </div>
                        <div class="summary-item">
                            <span>üî• ÂæπÂ∫ïÁ≤æÈÄ≤„Ç≥„Éº„ÇπÂ£≤‰∏ä</span>
                            <span id="appSellSalesAmount">¬•0</span>
                        </div>
                        <div class="summary-item">
                            <span>üöÄ NH„Éñ„Éº„Éà„Ç≠„É£„É≥„ÉóÂ£≤‰∏ä</span>
                            <span id="nhBootcampSalesAmount">¬•0</span>
                        </div>
                        <div class="summary-item total">
                            <span>Â£≤‰∏äÂêàË®à</span>
                            <span id="totalSalesAmount">¬•0</span>
                        </div>
                    </div>
                </div>

                <!-- „Ç≥„Éü„É•„Éã„ÉÜ„Ç£Ë©≥Á¥∞ -->
                <div class="summary-card">
                    <h3>üè¢ „Ç≥„Éü„É•„Éã„ÉÜ„Ç£Ë©≥Á¥∞</h3>
                    <div id="communityDetails">
                        <div class="summary-item">
                            <span>üìÖ ÊúàÈ°ç‰ºöÂì°</span>
                            <span id="monthlyMembersCount">0Âêç</span>
                        </div>
                        <div class="summary-item">
                            <span>üìÖ Âπ¥È°ç‰ºöÂì°</span>
                            <span id="yearlyMembersCount">0Âêç</span>
                        </div>
                        <div class="summary-item">
                            <span>Á∑è‰ºöÂì°Êï∞</span>
                            <span id="totalMembersCount">0Âêç</span>
                        </div>
                        <div class="summary-item">
                            <span>ÊúàÈ°çÂçò‰æ°</span>
                            <span>¬•22,000</span>
                        </div>
                        <div class="summary-item">
                            <span>Âπ¥È°çÂçò‰æ°</span>
                            <span>¬•220,000</span>
                        </div>
                    </div>
                </div>

                <!-- „Çµ„Éº„Éì„ÇπÂà•ÁµåË≤ª„Çµ„Éû„É™„Éº -->
                <div class="summary-card">
                    <h3>üí∏ „Çµ„Éº„Éì„ÇπÂà•ÁµåË≤ªÂÜÖË®≥</h3>
                    <div id="expenseSummary">
                        <div class="summary-item">
                            <span>üî• ÂæπÂ∫ïÁ≤æÈÄ≤„Ç≥„Éº„ÇπÁµåË≤ª</span>
                            <span id="appSellExpenseAmount">¬•0</span>
                        </div>
                        <div class="summary-item">
                            <span>üöÄ NH„Éñ„Éº„Éà„Ç≠„É£„É≥„ÉóÁµåË≤ª</span>
                            <span id="nhBootcampExpenseAmount">¬•0</span>
                        </div>
                        <div class="summary-item">
                            <span>üìù noteÊ±∫Ê∏àÊâãÊï∞Êñô</span>
                            <span id="noteCommissionExpenseAmount">¬•0</span>
                        </div>
                        <div class="summary-item">
                            <span>üè¢ „Ç≥„Éü„É•„Éã„ÉÜ„Ç£Ê±∫Ê∏àÊâãÊï∞Êñô</span>
                            <span id="communityCommissionExpenseAmount">¬•0</span>
                        </div>
                        <div class="summary-item">
                            <span>‰ºöÂ†¥Ë≤ª</span>
                            <span id="venueExpenseAmount">¬•0</span>
                        </div>
                        <div id="laborExpensesSummary">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã‰∫∫‰ª∂Ë≤ªÈ†ÖÁõÆ -->
                        </div>
                        <div class="summary-item">
                            <span>„Éû„Éº„Ç±„ÉÜ„Ç£„É≥„Ç∞Ë≤ª</span>
                            <span id="marketingExpenseAmount">¬•0</span>
                        </div>
                        <div class="summary-item">
                            <span>„Ç∑„Çπ„ÉÜ„É†Ë≤ª</span>
                            <span id="systemExpenseAmount">¬•0</span>
                        </div>
                        <div id="otherExpensesSummary">
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã„Åù„ÅÆ‰ªñÁµåË≤ªÈ†ÖÁõÆ -->
                        </div>
                        <div class="summary-item total">
                            <span>ÁµåË≤ªÂêàË®à</span>
                            <span id="totalExpenseAmount">¬•0</span>
                        </div>
                    </div>
                </div>

                <!-- ÂèéÊîØ„Çµ„Éû„É™„Éº -->
                <div class="summary-card">
                    <h3>üìä ÂèéÊîØ„Çµ„Éû„É™„Éº</h3>
                    <div id="profitSummary">
                        <div class="summary-item">
                            <span>Â£≤‰∏äÂêàË®à</span>
                            <span id="finalSalesAmount">¬•0</span>
                        </div>
                        <div class="summary-item">
                            <span>ÁµåË≤ªÂêàË®à</span>
                            <span id="finalExpenseAmount">¬•0</span>
                        </div>
                        <div class="summary-item total">
                            <span>Âà©Áõä</span>
                            <span id="finalProfitAmount">¬•0</span>
                        </div>
                        <div class="summary-item">
                            <span>Âà©ÁõäÁéá</span>
                            <span id="profitRateAmount">0.00%</span>
                        </div>
                    </div>
                </div>

                <button type="button" class="transfer-btn" onclick="transferToReport()">üìã ÂèéÊîØÂ†±Âëä„ÉÑ„Éº„É´„Å´Ëª¢ÈÄÅ</button>
            </div>
        </div>
    </div>

    <script>
        // Âπ¥„ÅÆÈÅ∏ÊäûËÇ¢„ÇíÁîüÊàê
        function generateYearOptions() {
            const yearSelect = document.getElementById('targetYear');
            const currentYear = new Date().getFullYear();
            
            for (let year = currentYear - 5; year <= currentYear + 2; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'Âπ¥';
                yearSelect.appendChild(option);
            }
        }

        // ÁèæÂú®„ÅÆÂπ¥Êúà„Çí„Éá„Éï„Ç©„É´„Éà„ÅßÈÅ∏Êäû
        function setDefaultDate() {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1;
            
            document.getElementById('targetYear').value = currentYear;
            document.getElementById('targetMonth').value = currentMonth;
        }

        // Êï∞ÂÄ§„ÅÆ„Éë„Éº„Çπ
        function parseNumber(value) {
            if (!value) return 0;
            return parseInt(value.replace(/[^\d]/g, ''));
        }

        // ÈáëÈ°ç„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatCurrency(amount) {
            return '¬•' + amount.toLocaleString();
        }



        // ‰∫∫‰ª∂Ë≤ªÈ†ÖÁõÆ„ÇíËøΩÂä†
        function addLaborExpense() {
            const container = document.getElementById('laborExpensesContainer');
            const newItem = document.createElement('div');
            newItem.className = 'expense-item labor-expense-item';
            newItem.innerHTML = `
                <div class="expense-item-header">
                    <label>‰∫∫‰ª∂Ë≤ªÈ†ÖÁõÆÂêç</label>
                    <button type="button" class="remove-btn" onclick="removeLaborExpense(this)">üóëÔ∏è</button>
                </div>
                <input type="text" class="labor-expense-label" value="‰∫∫‰ª∂Ë≤ª" placeholder="È†ÖÁõÆÂêç„ÇíÂÖ•Âäõ">
                <label>ÈáëÈ°ç</label>
                <input type="text" class="labor-expense-amount" placeholder="0" value="0">
            `;
            container.appendChild(newItem);
            
            // Êñ∞„Åó„ÅÑÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Å´„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
            const newInput = newItem.querySelector('.labor-expense-amount');
            newInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^\d]/g, '');
                if (value) {
                    value = parseInt(value).toLocaleString();
                }
                e.target.value = value;
                calculateTotal();
            });
            
            calculateTotal();
        }

        // ‰∫∫‰ª∂Ë≤ªÈ†ÖÁõÆ„ÇíÂâäÈô§
        function removeLaborExpense(button) {
            const container = document.getElementById('laborExpensesContainer');
            if (container.children.length > 1) {
                button.closest('.labor-expense-item').remove();
                calculateTotal();
            }
        }

        // „Åù„ÅÆ‰ªñÁµåË≤ªÈ†ÖÁõÆ„ÇíËøΩÂä†
        function addOtherExpense() {
            const container = document.getElementById('otherExpensesContainer');
            const newItem = document.createElement('div');
            newItem.className = 'expense-item other-expense-item';
            newItem.innerHTML = `
                <div class="expense-item-header">
                    <label>ÁµåË≤ªÈ†ÖÁõÆÂêç</label>
                    <button type="button" class="remove-btn" onclick="removeOtherExpense(this)">üóëÔ∏è</button>
                </div>
                <input type="text" class="other-expense-label" value="ÁµåË≤ª" placeholder="È†ÖÁõÆÂêç„ÇíÂÖ•Âäõ">
                <label>ÈáëÈ°ç</label>
                <input type="text" class="other-expense-amount" placeholder="0" value="0">
            `;
            container.appendChild(newItem);
            
            // Êñ∞„Åó„ÅÑÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Å´„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
            const newInput = newItem.querySelector('.other-expense-amount');
            newInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^\d]/g, '');
                if (value) {
                    value = parseInt(value).toLocaleString();
                }
                e.target.value = value;
                calculateTotal();
            });
            
            calculateTotal();
        }

        // „Åù„ÅÆ‰ªñÁµåË≤ªÈ†ÖÁõÆ„ÇíÂâäÈô§
        function removeOtherExpense(button) {
            const container = document.getElementById('otherExpensesContainer');
            if (container.children.length > 1) {
                button.closest('.other-expense-item').remove();
                calculateTotal();
            }
        }

        // ‰ºöÂì°Êï∞„ÅÆÂèÇËÄÉË®àÁÆó„ÇíÊõ¥Êñ∞
        function updateMembershipCalculations() {
            // ÊúàÈ°ç‰ºöÂì°Ë®àÁÆó
            const newMonthlyMembers = parseInt(document.getElementById('newMonthlyMembers').value) || 0;
            const continuingMonthlyMembers = parseInt(document.getElementById('continuingMonthlyMembers').value) || 0;
            const totalMonthlyMembers = newMonthlyMembers + continuingMonthlyMembers;
            const monthlySales = totalMonthlyMembers * 22000; // ÊúàÈ°ç2.2‰∏áÂÜÜ

            // Âπ¥È°ç‰ºöÂì°Ë®àÁÆó
            const newYearlyMembers = parseInt(document.getElementById('newYearlyMembers').value) || 0;
            const existingYearlyMembers = parseInt(document.getElementById('existingYearlyMembers').value) || 0;
            const totalYearlyMembers = newYearlyMembers + existingYearlyMembers;
            const yearlySales = newYearlyMembers * 220000; // Âπ¥È°ç22‰∏áÂÜÜÔºàÊñ∞Ë¶è„ÅÆ„ÅøÔºâ

            const calculatedCommunitySales = monthlySales + yearlySales;
            const totalCommunityMembers = totalMonthlyMembers + totalYearlyMembers;

            // ÂèÇËÄÉÊÉÖÂ†±„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
            document.getElementById('monthlyMembersSalesCalc').textContent = formatCurrency(monthlySales);
            document.getElementById('yearlyMembersSalesCalc').textContent = formatCurrency(yearlySales);
            document.getElementById('totalMembersSalesCalc').textContent = formatCurrency(calculatedCommunitySales);

            return { calculatedCommunitySales, totalCommunityMembers, totalMonthlyMembers, totalYearlyMembers };
        }

        // Á∑èÈõÜË®à
        function calculateTotal() {
            // ‰ºöÂì°Êï∞„ÅÆÂèÇËÄÉË®àÁÆó„ÇíÊõ¥Êñ∞
            const membershipData = updateMembershipCalculations();

            // ÊâãÂãïÂÖ•Âäõ„Åï„Çå„Åü„Ç≥„Éü„É•„Éã„ÉÜ„Ç£Â£≤‰∏ä„Çí‰ΩøÁî®
            const communitySales = parseNumber(document.getElementById('communitySalesManual').value);
            const totalCommunityMembers = membershipData.totalCommunityMembers;

            // „Åù„ÅÆ‰ªñ„ÅÆÂ£≤‰∏ä
            const noteSales = parseNumber(document.getElementById('noteSales').value);
            const appSellSales = parseNumber(document.getElementById('appSellSales').value);
            const nhBootcampSales = parseNumber(document.getElementById('nhBootcampSales').value);
            const totalSales = communitySales + noteSales + appSellSales + nhBootcampSales;

            // ÁµåË≤ªÈõÜË®à
            const appSellStaffExpense = parseNumber(document.getElementById('appSellStaffExpense').value);
            const appSellOtherExpense = parseNumber(document.getElementById('appSellOtherExpense').value);
            const appSellTotalExpense = appSellStaffExpense + appSellOtherExpense;

            const nhBootcampStaffExpense = parseNumber(document.getElementById('nhBootcampStaffExpense').value);
            const nhBootcampOtherExpense = parseNumber(document.getElementById('nhBootcampOtherExpense').value);
            const nhBootcampTotalExpense = nhBootcampStaffExpense + nhBootcampOtherExpense;

            const noteCommissionExpense = parseNumber(document.getElementById('noteCommissionExpense').value);
            const communityCommissionExpense = parseNumber(document.getElementById('communityCommissionExpense').value);
            
            const venueExpense = parseNumber(document.getElementById('venueExpense').value);
            const marketingExpense = parseNumber(document.getElementById('marketingExpense').value);
            const systemExpense = parseNumber(document.getElementById('systemExpense').value);
            
            // ÂãïÁöÑ‰∫∫‰ª∂Ë≤ªÈõÜË®à
            const laborExpenseItems = document.querySelectorAll('.labor-expense-item');
            let totalLaborExpense = 0;
            let laborExpensesSummary = '';
            
            laborExpenseItems.forEach((item, index) => {
                const label = item.querySelector('.labor-expense-label').value || `‰∫∫‰ª∂Ë≤ª${index + 1}`;
                const amount = parseNumber(item.querySelector('.labor-expense-amount').value);
                totalLaborExpense += amount;
                if (amount > 0) {
                    laborExpensesSummary += `<div class="summary-item"><span>${label}</span><span>${formatCurrency(amount)}</span></div>`;
                }
            });
            
            // ÂãïÁöÑ„Åù„ÅÆ‰ªñÁµåË≤ªÈõÜË®à
            const otherExpenseItems = document.querySelectorAll('.other-expense-item');
            let totalOtherExpense = 0;
            let otherExpensesSummary = '';
            
            otherExpenseItems.forEach((item, index) => {
                const label = item.querySelector('.other-expense-label').value || `ÁµåË≤ª${index + 1}`;
                const amount = parseNumber(item.querySelector('.other-expense-amount').value);
                totalOtherExpense += amount;
                if (amount > 0) {
                    otherExpensesSummary += `<div class="summary-item"><span>${label}</span><span>${formatCurrency(amount)}</span></div>`;
                }
            });
            
            const totalExpenses = appSellTotalExpense + nhBootcampTotalExpense + noteCommissionExpense + communityCommissionExpense + venueExpense + totalLaborExpense + marketingExpense + systemExpense + totalOtherExpense;

            // Âà©ÁõäË®àÁÆó
            const profit = totalSales - totalExpenses;
            const profitRate = totalSales > 0 ? (profit / totalSales) * 100 : 0;

            // Ë°®Á§∫Êõ¥Êñ∞
            document.getElementById('communitySalesAmount').textContent = formatCurrency(communitySales);
            document.getElementById('noteSalesAmount').textContent = formatCurrency(noteSales);
            document.getElementById('appSellSalesAmount').textContent = formatCurrency(appSellSales);
            document.getElementById('nhBootcampSalesAmount').textContent = formatCurrency(nhBootcampSales);
            document.getElementById('totalSalesAmount').textContent = formatCurrency(totalSales);

            document.getElementById('monthlyMembersCount').textContent = membershipData.totalMonthlyMembers + 'Âêç';
            document.getElementById('yearlyMembersCount').textContent = membershipData.totalYearlyMembers + 'Âêç';
            document.getElementById('totalMembersCount').textContent = totalCommunityMembers + 'Âêç';

            document.getElementById('appSellExpenseAmount').textContent = formatCurrency(appSellTotalExpense);
            document.getElementById('nhBootcampExpenseAmount').textContent = formatCurrency(nhBootcampTotalExpense);
            document.getElementById('noteCommissionExpenseAmount').textContent = formatCurrency(noteCommissionExpense);
            document.getElementById('communityCommissionExpenseAmount').textContent = formatCurrency(communityCommissionExpense);
            document.getElementById('venueExpenseAmount').textContent = formatCurrency(venueExpense);
            document.getElementById('laborExpenseAmount').textContent = formatCurrency(laborExpense);
            document.getElementById('marketingExpenseAmount').textContent = formatCurrency(marketingExpense);
            document.getElementById('systemExpenseAmount').textContent = formatCurrency(systemExpense);
            document.getElementById('otherExpenseAmount').textContent = formatCurrency(otherExpense);
            document.getElementById('totalExpenseAmount').textContent = formatCurrency(totalExpenses);

            document.getElementById('finalSalesAmount').textContent = formatCurrency(totalSales);
            document.getElementById('finalExpenseAmount').textContent = formatCurrency(totalExpenses);
            document.getElementById('finalProfitAmount').textContent = formatCurrency(profit);
            document.getElementById('profitRateAmount').textContent = profitRate.toFixed(2) + '%';
        }

        // ÂèéÊîØÂ†±Âëä„ÉÑ„Éº„É´„Å´Ëª¢ÈÄÅ
        function transferToReport() {
            const totalSales = parseNumber(document.getElementById('totalSalesAmount').textContent.replace(/[^\d]/g, ''));
            const totalExpenses = parseNumber(document.getElementById('totalExpenseAmount').textContent.replace(/[^\d]/g, ''));
            
            // ‰ºöÂì°Êï∞„Éá„Éº„Çø„ÇÇ‰øùÂ≠ò
            const totalMonthlyMembers = parseInt(document.getElementById('newMonthlyMembers').value) || 0 + parseInt(document.getElementById('continuingMonthlyMembers').value) || 0;
            const totalYearlyMembers = parseInt(document.getElementById('newYearlyMembers').value) || 0 + parseInt(document.getElementById('existingYearlyMembers').value) || 0;
            const totalMembers = totalMonthlyMembers + totalYearlyMembers;
            
            // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰∏ÄÊôÇ‰øùÂ≠ò
            localStorage.setItem('temp_sales', totalSales);
            localStorage.setItem('temp_expenses', totalExpenses);
            localStorage.setItem('temp_yearlyMembers', totalYearlyMembers);
            localStorage.setItem('temp_regularMembers', totalMonthlyMembers);
            localStorage.setItem('temp_trialMembers', 0); // ‰ΩìÈ®ì‰ºöÂì°„ÅØ0„Å®„Åó„Å¶Ë®≠ÂÆö
            
            alert('„Éá„Éº„Çø„ÇíÂèéÊîØÂ†±Âëä„ÉÑ„Éº„É´„Å´Ëª¢ÈÄÅ„Åó„Åæ„Åó„Åü„ÄÇÂèéÊîØÂ†±Âëä„ÉÑ„Éº„É´„ÇíÈñã„ÅÑ„Å¶„Äå„Éá„Éº„ÇøËª¢ÈÄÅ„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        }

        // ÂÖ•ÂäõÂÄ§„ÅÆËá™Âãï„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function addNumberFormatting() {
            const numberInputs = ['communitySalesManual', 'communityCommissionExpense', 'noteSales', 'noteCommissionExpense', 'appSellSales', 'nhBootcampSales', 'appSellStaffExpense', 'appSellOtherExpense', 'nhBootcampStaffExpense', 'nhBootcampOtherExpense', 'venueExpense', 'laborExpense', 'marketingExpense', 'systemExpense', 'otherExpense'];
            
            numberInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', function(e) {
                        let value = e.target.value.replace(/[^\d]/g, '');
                        if (value) {
                            value = parseInt(value).toLocaleString();
                        }
                        e.target.value = value;
                        calculateTotal();
                    });
                }
            });

            // ‰ºöÂì°Êï∞„ÅÆÂÖ•ÂäõÁõ£Ë¶ñÔºàÂèÇËÄÉË®àÁÆóÁî®Ôºâ
            const memberInputs = ['newMonthlyMembers', 'continuingMonthlyMembers', 'newYearlyMembers', 'existingYearlyMembers'];
            memberInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', function(e) {
                        updateMembershipCalculations();
                    });
                }
            });
        }

        // „ÉÜ„Çπ„Éà„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÊ©üËÉΩ
        function loadTestData() {
            const month = document.getElementById('targetMonth').value;
            const testData = getTestData(month);
            
            if (testData) {
                // Âπ¥ÊúàË®≠ÂÆö
                document.getElementById('targetYear').value = testData.year;
                document.getElementById('targetMonth').value = testData.month;
                
                // „Ç≥„Éü„É•„Éã„ÉÜ„Ç£Â£≤‰∏ä„Å®‰ºöÂì°Êï∞
                document.getElementById('communitySalesManual').value = testData.communitySales.toLocaleString();
                document.getElementById('communityCommissionExpense').value = testData.communityCommissionExpense.toLocaleString();
                document.getElementById('newMonthlyMembers').value = testData.newMonthlyMembers;
                document.getElementById('continuingMonthlyMembers').value = testData.continuingMonthlyMembers;
                document.getElementById('newYearlyMembers').value = testData.newYearlyMembers;
                document.getElementById('existingYearlyMembers').value = testData.existingYearlyMembers;
                
                // Â£≤‰∏ä
                document.getElementById('noteSales').value = testData.noteSales.toLocaleString();
                document.getElementById('appSellSales').value = testData.appSellSales.toLocaleString();
                document.getElementById('nhBootcampSales').value = testData.nhBootcampSales.toLocaleString();
                
                // ÁµåË≤ª
                document.getElementById('appSellStaffExpense').value = testData.appSellStaffExpense.toLocaleString();
                document.getElementById('appSellOtherExpense').value = testData.appSellOtherExpense.toLocaleString();
                document.getElementById('nhBootcampStaffExpense').value = testData.nhBootcampStaffExpense.toLocaleString();
                document.getElementById('nhBootcampOtherExpense').value = testData.nhBootcampOtherExpense.toLocaleString();
                document.getElementById('noteCommissionExpense').value = testData.noteCommissionExpense.toLocaleString();
                document.getElementById('venueExpense').value = testData.venueExpense.toLocaleString();
                document.getElementById('marketingExpense').value = testData.marketingExpense.toLocaleString();
                document.getElementById('systemExpense').value = testData.systemExpense.toLocaleString();
                
                // ‰∫∫‰ª∂Ë≤ªÔºàÊúÄÂàù„ÅÆÈ†ÖÁõÆ„ÅÆ„ÅøÔºâ
                const laborItems = document.querySelectorAll('.labor-expense-item');
                if (laborItems.length > 0) {
                    laborItems[0].querySelector('.labor-expense-label').value = '‰∫∫‰ª∂Ë≤ª';
                    laborItems[0].querySelector('.labor-expense-amount').value = testData.laborExpense.toLocaleString();
                }
                
                // „Åù„ÅÆ‰ªñÁµåË≤ªÔºàÊúÄÂàù„ÅÆÈ†ÖÁõÆ„ÅÆ„ÅøÔºâ
                const otherItems = document.querySelectorAll('.other-expense-item');
                if (otherItems.length > 0) {
                    otherItems[0].querySelector('.other-expense-label').value = '„Åù„ÅÆ‰ªñÁµåË≤ª';
                    otherItems[0].querySelector('.other-expense-amount').value = testData.otherExpense.toLocaleString();
                }
                
                // ÈõÜË®àÂÆüË°å
                calculateTotal();
                
                alert(`${testData.year}Âπ¥${testData.month}Êúà„ÅÆ„ÉÜ„Çπ„Éà„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„ÅüÔºÅ`);
            } else {
                alert('ÈÅ∏Êäû„Åï„Çå„ÅüÊúà„ÅÆ„ÉÜ„Çπ„Éà„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ2024Âπ¥12Êúà„Äú2025Âπ¥4Êúà„ÅÆ„Éá„Éº„Çø„ÅåÂà©Áî®ÂèØËÉΩ„Åß„Åô„ÄÇ');
            }
        }

        // „ÉÜ„Çπ„Éà„Éá„Éº„ÇøÂÆöÁæ©
        function getTestData(month) {
            const testData = {
                '12': {
                    year: '2024',
                    month: '12',
                    communitySales: 550000,
                    communityCommissionExpense: 16500,
                    newMonthlyMembers: 5,
                    continuingMonthlyMembers: 0,
                    newYearlyMembers: 2,
                    existingYearlyMembers: 2,
                    noteSales: 85000,
                    appSellSales: 320000,
                    nhBootcampSales: 180000,
                    appSellStaffExpense: 80000,
                    appSellOtherExpense: 40000,
                    nhBootcampStaffExpense: 50000,
                    nhBootcampOtherExpense: 30000,
                    noteCommissionExpense: 8500,
                    venueExpense: 50000,
                    laborExpense: 200000,
                    marketingExpense: 30000,
                    systemExpense: 15000,
                    otherExpense: 25000
                },
                '01': {
                    year: '2025',
                    month: '01',
                    communitySales: 946000,
                    communityCommissionExpense: 28380,
                    newMonthlyMembers: 8,
                    continuingMonthlyMembers: 5,
                    newYearlyMembers: 3,
                    existingYearlyMembers: 5,
                    noteSales: 120000,
                    appSellSales: 450000,
                    nhBootcampSales: 220000,
                    appSellStaffExpense: 100000,
                    appSellOtherExpense: 50000,
                    nhBootcampStaffExpense: 60000,
                    nhBootcampOtherExpense: 35000,
                    noteCommissionExpense: 12000,
                    venueExpense: 55000,
                    laborExpense: 250000,
                    marketingExpense: 40000,
                    systemExpense: 18000,
                    otherExpense: 30000
                },
                '02': {
                    year: '2025',
                    month: '02',
                    communitySales: 1430000,
                    communityCommissionExpense: 42900,
                    newMonthlyMembers: 12,
                    continuingMonthlyMembers: 13,
                    newYearlyMembers: 4,
                    existingYearlyMembers: 8,
                    noteSales: 150000,
                    appSellSales: 520000,
                    nhBootcampSales: 280000,
                    appSellStaffExpense: 120000,
                    appSellOtherExpense: 60000,
                    nhBootcampStaffExpense: 70000,
                    nhBootcampOtherExpense: 40000,
                    noteCommissionExpense: 15000,
                    venueExpense: 60000,
                    laborExpense: 300000,
                    marketingExpense: 50000,
                    systemExpense: 20000,
                    otherExpense: 35000
                },
                '03': {
                    year: '2025',
                    month: '03',
                    communitySales: 1980000,
                    communityCommissionExpense: 59400,
                    newMonthlyMembers: 15,
                    continuingMonthlyMembers: 25,
                    newYearlyMembers: 5,
                    existingYearlyMembers: 13,
                    noteSales: 180000,
                    appSellSales: 580000,
                    nhBootcampSales: 320000,
                    appSellStaffExpense: 140000,
                    appSellOtherExpense: 60000,
                    nhBootcampStaffExpense: 80000,
                    nhBootcampOtherExpense: 45000,
                    noteCommissionExpense: 18000,
                    venueExpense: 65000,
                    laborExpense: 350000,
                    marketingExpense: 60000,
                    systemExpense: 22000,
                    otherExpense: 40000
                },
                '04': {
                    year: '2025',
                    month: '04',
                    communitySales: 2596000,
                    communityCommissionExpense: 77880,
                    newMonthlyMembers: 18,
                    continuingMonthlyMembers: 40,
                    newYearlyMembers: 6,
                    existingYearlyMembers: 19,
                    noteSales: 220000,
                    appSellSales: 650000,
                    nhBootcampSales: 380000,
                    appSellStaffExpense: 160000,
                    appSellOtherExpense: 60000,
                    nhBootcampStaffExpense: 90000,
                    nhBootcampOtherExpense: 50000,
                    noteCommissionExpense: 22000,
                    venueExpense: 70000,
                    laborExpense: 400000,
                    marketingExpense: 70000,
                    systemExpense: 25000,
                    otherExpense: 45000
                }
            };
            
            return testData[month];
        }

        // „Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„ÉàËß£ÊûêÊ©üËÉΩ
        document.getElementById('analyzeBtn').addEventListener('click', function() {
            analyzeSpreadsheetData();
        });

        document.getElementById('applyAnalysisBtn').addEventListener('click', function() {
            applyAnalysisToSales();
        });

        function analyzeSpreadsheetData() {
            const data = document.getElementById('spreadsheetData').value.trim();
            const dataType = document.getElementById('dataType').value;
            
            if (!data) {
                alert('„Éá„Éº„Çø„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            try {
                const lines = data.split('\n').filter(line => line.trim());
                const delimiter = detectDelimiter(data, dataType);
                const parsedData = parseSpreadsheetData(lines, delimiter);
                const analysis = analyzeSalesData(parsedData);
                
                displayAnalysisResult(analysis);
            } catch (error) {
                alert('„Éá„Éº„Çø„ÅÆËß£Êûê‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            }
        }

        function detectDelimiter(data, dataType) {
            if (dataType === 'tab') return '\t';
            if (dataType === 'comma') return ',';
            
            // Ëá™ÂãïÂà§ÂÆö
            const firstLine = data.split('\n')[0];
            const tabCount = (firstLine.match(/\t/g) || []).length;
            const commaCount = (firstLine.match(/,/g) || []).length;
            
            return tabCount > commaCount ? '\t' : ',';
        }

        function parseSpreadsheetData(lines, delimiter) {
            const parsedData = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const columns = line.split(delimiter);
                if (columns.length < 6) continue; // ÊúÄ‰Ωé6ÂàóÂøÖË¶Å
                
                // ÈáëÈ°çÂàó„ÇíÊé¢„ÅôÔºà¬•Ë®òÂè∑„ÇíÂê´„ÇÄÂàóÔºâ
                let amountIndex = -1;
                for (let j = 0; j < columns.length; j++) {
                    if (columns[j].includes('¬•') || columns[j].includes('ÂÜÜ')) {
                        amountIndex = j;
                        break;
                    }
                }
                
                if (amountIndex === -1) continue;
                
                // ÈáëÈ°ç„ÇíÊäΩÂá∫„Åó„Å¶Êï∞ÂÄ§„Å´Â§âÊèõ
                const amountStr = columns[amountIndex].replace(/[¬•,\s]/g, '');
                const amount = parseInt(amountStr);
                
                if (isNaN(amount)) continue;
                
                parsedData.push({
                    date: columns[0] || '',
                    name: columns[1] || '',
                    email: columns[2] || '',
                    product: columns[3] || '',
                    paymentMethod: columns[4] || '',
                    amount: amount,
                    paymentType: columns[6] || '',
                    originalLine: line
                });
            }
            
            return parsedData;
        }

        function analyzeSalesData(data) {
            const totalSales = data.reduce((sum, item) => sum + item.amount, 0);
            const transactionCount = data.length;
            
            // ÂïÜÂìÅÂà•ÈõÜË®à
            const productSummary = {};
            data.forEach(item => {
                const product = item.product || '‰∏çÊòé';
                if (!productSummary[product]) {
                    productSummary[product] = { count: 0, amount: 0 };
                }
                productSummary[product].count++;
                productSummary[product].amount += item.amount;
            });
            
            // Ê±∫Ê∏àÊñπÊ≥ïÂà•ÈõÜË®à
            const paymentSummary = {};
            data.forEach(item => {
                const method = item.paymentMethod || '‰∏çÊòé';
                if (!paymentSummary[method]) {
                    paymentSummary[method] = { count: 0, amount: 0 };
                }
                paymentSummary[method].count++;
                paymentSummary[method].amount += item.amount;
            });
            
            // NH„Éñ„Éº„Éà„Ç≠„É£„É≥„ÉóÈñ¢ÈÄ£„ÅÆÂ£≤‰∏ä„ÇíÁâπÂÆö
            const nhBootcampSales = data
                .filter(item => item.product && item.product.includes('NH„Éñ„Éº„Éà„Ç≠„É£„É≥„Éó'))
                .reduce((sum, item) => sum + item.amount, 0);
            
            // „Åù„ÅÆ‰ªñ„ÅÆÂ£≤‰∏äÔºàNH„Éñ„Éº„Éà„Ç≠„É£„É≥„Éó‰ª•Â§ñÔºâ
            const otherSales = totalSales - nhBootcampSales;
            
            return {
                totalSales,
                transactionCount,
                productSummary,
                paymentSummary,
                nhBootcampSales,
                otherSales,
                rawData: data
            };
        }

        function displayAnalysisResult(analysis) {
            const resultDiv = document.getElementById('analysisResult');
            const contentDiv = document.getElementById('analysisContent');
            
            let html = `
                <div style="margin-bottom: 15px;">
                    <strong>Á∑èÂ£≤‰∏ä:</strong> ¬•${analysis.totalSales.toLocaleString()}<br>
                    <strong>ÂèñÂºï‰ª∂Êï∞:</strong> ${analysis.transactionCount}‰ª∂
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>ÂïÜÂìÅÂà•ÈõÜË®à:</strong>
                    <ul style="margin: 5px 0; padding-left: 20px;">
            `;
            
            Object.entries(analysis.productSummary).forEach(([product, data]) => {
                html += `<li>${product}: ${data.count}‰ª∂ √ó ¬•${data.amount.toLocaleString()}</li>`;
            });
            
            html += `
                    </ul>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>Ê±∫Ê∏àÊñπÊ≥ïÂà•ÈõÜË®à:</strong>
                    <ul style="margin: 5px 0; padding-left: 20px;">
            `;
            
            Object.entries(analysis.paymentSummary).forEach(([method, data]) => {
                html += `<li>${method}: ${data.count}‰ª∂ √ó ¬•${data.amount.toLocaleString()}</li>`;
            });
            
            html += `
                    </ul>
                </div>
                
                <div style="margin-bottom: 15px; padding: 10px; background: #e8f5e8; border-radius: 4px;">
                    <strong>Êé®Â•®Ë®≠ÂÆö:</strong><br>
                    <strong>NH„Éñ„Éº„Éà„Ç≠„É£„É≥„ÉóÂ£≤‰∏ä:</strong> ¬•${analysis.nhBootcampSales.toLocaleString()}<br>
                    <strong>„Åù„ÅÆ‰ªñÂ£≤‰∏ä:</strong> ¬•${analysis.otherSales.toLocaleString()}
                </div>
            `;
            
            contentDiv.innerHTML = html;
            resultDiv.style.display = 'block';
            
            // Ëß£ÊûêÁµêÊûú„Çí„Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å´‰øùÂ≠ò
            window.currentAnalysis = analysis;
        }

        function applyAnalysisToSales() {
            if (!window.currentAnalysis) {
                alert('ÂÖà„Å´„Éá„Éº„Çø„ÇíËß£Êûê„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const analysis = window.currentAnalysis;
            
            // NH„Éñ„Éº„Éà„Ç≠„É£„É≥„ÉóÂ£≤‰∏ä„ÇíË®≠ÂÆö
            document.getElementById('nhBootcampSales').value = analysis.nhBootcampSales.toLocaleString();
            
            // „Åù„ÅÆ‰ªñ„ÅÆÂ£≤‰∏ä„ÇíÈÅ©Âàá„Å™È†ÖÁõÆ„Å´Ë®≠ÂÆöÔºà‰æãÔºöÂæπÂ∫ïÁ≤æÈÄ≤„Ç≥„Éº„ÇπÔºâ
            if (analysis.otherSales > 0) {
                document.getElementById('appSellSales').value = analysis.otherSales.toLocaleString();
            }
            
            // Ëá™Âãï„ÅßÈõÜË®à„ÇíÂÆüË°å
            calculateTotal();
            
            alert(`Â£≤‰∏ä„Éá„Éº„Çø„ÇíË®≠ÂÆö„Åó„Åæ„Åó„ÅüÔºÅ\n\nNH„Éñ„Éº„Éà„Ç≠„É£„É≥„Éó: ¬•${analysis.nhBootcampSales.toLocaleString()}\n„Åù„ÅÆ‰ªñ: ¬•${analysis.otherSales.toLocaleString()}`);
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            generateYearOptions();
            setDefaultDate();
            addNumberFormatting();
        });
    </script>
</body>
</html>
