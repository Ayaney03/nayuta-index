<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç„¡æ˜ä¼š å£²ä¸ŠçµŒè²»é›†è¨ˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'Yu Gothic', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #f8f6f3 0%, #fff8dc 50%, #f5e6a3 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #f5e6a3 0%, #d4af37 50%, #b8860b 100%);
            color: #8b6914;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 600px;
        }

        .input-section {
            padding: 40px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
        }

        .output-section {
            padding: 40px;
            background: white;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #d4af37;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .upload-area {
            border: 2px dashed #d4af37;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #fff8dc;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #b8860b;
            background: #f5e6a3;
        }

        .upload-area input[type="file"] {
            border: none;
            background: transparent;
        }

        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .data-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: border-color 0.3s ease;
        }

        .data-item:hover {
            border-color: #d4af37;
        }

        .data-item label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            display: block;
        }

        .data-item input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .service-section {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .service-section h4 {
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .expense-item {
            margin-bottom: 15px;
        }

        .expense-item label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9em;
        }

        .expense-item input, .expense-item select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9em;
        }

        .expense-section {
            margin-bottom: 25px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-header h5 {
            margin: 0;
            font-size: 1em;
        }

        .add-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .add-btn:hover {
            background: #218838;
        }

        .expense-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .remove-btn:hover {
            background: #c82333;
        }

        .labor-expense-item, .other-expense-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .calculate-btn {
            background: linear-gradient(135deg, #d4af37 0%, #b8860b 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
        }

        .summary-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #d4af37;
            padding-bottom: 8px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .summary-item:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 1.1em;
            color: #2c3e50;
        }

        .summary-item.total {
            background: #d4af37;
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
        }

        .transfer-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            margin-top: 15px;
            width: 100%;
        }

        .transfer-btn:hover {
            background: #218838;
        }

        .csv-preview {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
        }

        .help-text {
            font-size: 0.85em;
            color: #6c757d;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ç„¡æ˜ä¼š å£²ä¸ŠçµŒè²»é›†è¨ˆãƒ„ãƒ¼ãƒ«</h1>
            <p>è¤‡æ•°ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‹ã‚‰å£²ä¸Šãƒ»çµŒè²»ã‚’è‡ªå‹•é›†è¨ˆã—ã¾ã™</p>
        </div>
        
        <div class="content">
            <div class="input-section">
                <h2 class="section-title">ğŸ“ ãƒ‡ãƒ¼ã‚¿å…¥åŠ›</h2>
                
                <!-- å¯¾è±¡å¹´æœˆ -->
                <div class="form-group">
                    <label>å¯¾è±¡å¹´æœˆ</label>
                    <div class="data-grid">
                        <div>
                            <label for="targetYear">å¹´</label>
                            <select id="targetYear" required>
                                <option value="">å¹´ã‚’é¸æŠ</option>
                            </select>
                        </div>
                        <div>
                            <label for="targetMonth">æœˆ</label>
                            <select id="targetMonth" required>
                                <option value="">æœˆã‚’é¸æŠ</option>
                                <option value="1">1æœˆ</option>
                                <option value="2">2æœˆ</option>
                                <option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option>
                                <option value="5">5æœˆ</option>
                                <option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option>
                                <option value="8">8æœˆ</option>
                                <option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12">12æœˆ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ã‚µãƒ¼ãƒ“ã‚¹åˆ¥å£²ä¸Šãƒ‡ãƒ¼ã‚¿å…¥åŠ› -->
                <div class="form-group">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ’° ã‚µãƒ¼ãƒ“ã‚¹åˆ¥å£²ä¸Šãƒ‡ãƒ¼ã‚¿</h3>
                    
                    <!-- ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å£²ä¸Š -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">ğŸ¢ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£</h4>
                        
                        <!-- æ‰‹å‹•å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="communitySalesManual">ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å£²ä¸Šé‡‘é¡</label>
                                <input type="text" id="communitySalesManual" placeholder="0" value="0">
                                <div class="help-text">æœˆé¡ãƒ»å¹´é¡ä¼šå“¡ã®åˆè¨ˆå£²ä¸Šã‚’å…¥åŠ›</div>
                            </div>
                            <div class="data-item">
                                <label for="communityCommissionExpense">æ±ºæ¸ˆæ‰‹æ•°æ–™</label>
                                <input type="text" id="communityCommissionExpense" placeholder="0" value="0">
                                <div class="help-text">ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å£²ä¸Šã®æ±ºæ¸ˆæ‰‹æ•°æ–™</div>
                            </div>
                        </div>

                        <!-- å‚è€ƒæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                        <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 6px; padding: 15px; margin-top: 15px;">
                            <h5 style="color: #6c757d; margin-bottom: 10px;">ğŸ“‹ å‚è€ƒæƒ…å ±ï¼ˆè‡ªå‹•è¨ˆç®—ï¼‰</h5>
                            
                            <!-- æœˆé¡ä¼šå“¡ -->
                            <div class="membership-section">
                                <h6 style="color: #2c3e50; margin-bottom: 10px;">ğŸ“… æœˆé¡ä¼šå“¡ï¼ˆ2.2ä¸‡å††ç¨è¾¼ï¼‰</h6>
                                <div class="data-grid">
                                    <div class="data-item">
                                        <label for="newMonthlyMembers">æ–°è¦å…¥ä¼šè€…æ•°</label>
                                        <input type="number" id="newMonthlyMembers" placeholder="0" value="0" min="0">
                                    </div>
                                    <div class="data-item">
                                        <label for="continuingMonthlyMembers">ç¶™ç¶šæ±ºæ¸ˆè€…æ•°</label>
                                        <input type="number" id="continuingMonthlyMembers" placeholder="0" value="0" min="0">
                                    </div>
                                </div>
                                <div style="margin-top: 8px; font-size: 0.9em; color: #6c757d;">
                                    è¨ˆç®—çµæœ: <span id="monthlyMembersSalesCalc">Â¥0</span>
                                </div>
                            </div>

                            <!-- å¹´é¡ä¼šå“¡ -->
                            <div class="membership-section">
                                <h6 style="color: #2c3e50; margin-bottom: 10px;">ğŸ“… å¹´é¡ä¼šå“¡ï¼ˆ22ä¸‡å††ç¨è¾¼ï¼‰</h6>
                                <div class="data-grid">
                                    <div class="data-item">
                                        <label for="newYearlyMembers">æ–°è¦å…¥ä¼šè€…æ•°</label>
                                        <input type="number" id="newYearlyMembers" placeholder="0" value="0" min="0">
                                    </div>
                                    <div class="data-item">
                                        <label for="existingYearlyMembers">åœ¨ç±å¹´é¡ä¼šå“¡æ•°</label>
                                        <input type="number" id="existingYearlyMembers" placeholder="0" value="0" min="0">
                                    </div>
                                </div>
                                <div style="margin-top: 8px; font-size: 0.9em; color: #6c757d;">
                                    è¨ˆç®—çµæœ: <span id="yearlyMembersSalesCalc">Â¥0</span>
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #e9ecef; font-weight: 600; color: #2c3e50;">
                                åˆè¨ˆ: <span id="totalMembersSalesCalc">Â¥0</span>
                            </div>
                        </div>
                    </div>

                    <!-- noteå£²ä¸Šãƒ»çµŒè²» -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">ğŸ“ note</h4>
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="noteSales">å£²ä¸Šé‡‘é¡</label>
                                <input type="text" id="noteSales" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="noteCommissionExpense">æ±ºæ¸ˆæ‰‹æ•°æ–™</label>
                                <input type="text" id="noteCommissionExpense" placeholder="0" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- å¾¹åº•ç²¾é€²ã‚³ãƒ¼ã‚¹å£²ä¸Šãƒ»çµŒè²» -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">ğŸ”¥ å¾¹åº•ç²¾é€²ã‚³ãƒ¼ã‚¹</h4>
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="appSellSales">æŒ¯è¾¼å£²ä¸Šé‡‘é¡</label>
                                <input type="text" id="appSellSales" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="appSellStaffExpense">ã‚¹ã‚¿ãƒƒãƒ•ãƒ»æŒ‡å°è€…äººä»¶è²»</label>
                                <input type="text" id="appSellStaffExpense" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="appSellOtherExpense">ãã®ä»–çµŒè²»</label>
                                <input type="text" id="appSellOtherExpense" placeholder="0" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- NHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—å£²ä¸Šãƒ»çµŒè²» -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">ğŸ’ª NHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—</h4>
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="nhBootcampSales">å£²ä¸Šé‡‘é¡</label>
                                <input type="text" id="nhBootcampSales" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="nhBootcampStaffExpense">ã‚¹ã‚¿ãƒƒãƒ•ãƒ»æŒ‡å°è€…äººä»¶è²»</label>
                                <input type="text" id="nhBootcampStaffExpense" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="nhBootcampOtherExpense">ãã®ä»–çµŒè²»</label>
                                <input type="text" id="nhBootcampOtherExpense" placeholder="0" value="0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ã‚µãƒ¼ãƒ“ã‚¹åˆ¥çµŒè²»ãƒ‡ãƒ¼ã‚¿å…¥åŠ› -->
                <div class="form-group">
                    <h3 style="color: #2c3e50; margin-bottom: 15px;">ğŸ’¸ ã‚µãƒ¼ãƒ“ã‚¹åˆ¥çµŒè²»ãƒ‡ãƒ¼ã‚¿</h3>
                    
                    <!-- å¾¹åº•ç²¾é€²ã‚³ãƒ¼ã‚¹çµŒè²» -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">ğŸ“š å¾¹åº•ç²¾é€²ã‚³ãƒ¼ã‚¹çµŒè²»</h4>
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="appSellStaffExpense">ã‚¹ã‚¿ãƒƒãƒ•ãƒ»æŒ‡å°è€…äººä»¶è²»</label>
                                <input type="text" id="appSellStaffExpense" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="appSellOtherExpense">ãã®ä»–çµŒè²»</label>
                                <input type="text" id="appSellOtherExpense" placeholder="0" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- NHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—çµŒè²» -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">ğŸš€ NHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—çµŒè²»</h4>
                        <div class="data-grid">
                            <div class="data-item">
                                <label for="nhBootcampStaffExpense">ã‚¹ã‚¿ãƒƒãƒ•ãƒ»æŒ‡å°è€…äººä»¶è²»</label>
                                <input type="text" id="nhBootcampStaffExpense" placeholder="0" value="0">
                            </div>
                            <div class="data-item">
                                <label for="nhBootcampOtherExpense">ãã®ä»–çµŒè²»</label>
                                <input type="text" id="nhBootcampOtherExpense" placeholder="0" value="0">
                            </div>
                        </div>
                    </div>



                    <!-- å…±é€šçµŒè²» -->
                    <div class="service-section">
                        <h4 style="color: #d4af37; margin-bottom: 10px;">ğŸ¢ å…±é€šçµŒè²»</h4>
                        
                        <!-- ä¼šå ´è²» -->
                        <div class="expense-item">
                            <label for="venueExpense">ä¼šå ´è²»</label>
                            <input type="text" id="venueExpense" placeholder="0" value="0">
                        </div>

                        <!-- äººä»¶è²»ï¼ˆå‹•çš„è¿½åŠ ï¼‰ -->
                        <div class="expense-section">
                            <div class="section-header">
                                <h5 style="color: #2c3e50; margin-bottom: 10px;">ğŸ‘¥ äººä»¶è²»</h5>
                                <button type="button" class="add-btn" onclick="addLaborExpense()">â• äººä»¶è²»é …ç›®ã‚’è¿½åŠ </button>
                            </div>
                            <div id="laborExpensesContainer">
                                <div class="expense-item labor-expense-item">
                                    <div class="expense-item-header">
                                        <label>äººä»¶è²»é …ç›®å</label>
                                        <button type="button" class="remove-btn" onclick="removeLaborExpense(this)" style="display: none;">ğŸ—‘ï¸</button>
                                    </div>
                                    <input type="text" class="labor-expense-label" value="ä¸€èˆ¬çš„äººä»¶è²»" placeholder="é …ç›®åã‚’å…¥åŠ›">
                                    <label>é‡‘é¡</label>
                                    <input type="text" class="labor-expense-amount" placeholder="0" value="0">
                                </div>
                            </div>
                        </div>

                        <!-- ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°è²» -->
                        <div class="expense-item">
                            <label for="marketingExpense">ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°è²»ï¼ˆLINEã€Xã€å®´ç­‰ï¼‰</label>
                            <input type="text" id="marketingExpense" placeholder="0" value="0">
                        </div>

                        <!-- ã‚·ã‚¹ãƒ†ãƒ è²» -->
                        <div class="expense-item">
                            <label for="systemExpense">ã‚·ã‚¹ãƒ†ãƒ è²»</label>
                            <input type="text" id="systemExpense" placeholder="0" value="0">
                        </div>

                        <!-- ãã®ä»–çµŒè²»ï¼ˆå‹•çš„è¿½åŠ ï¼‰ -->
                        <div class="expense-section">
                            <div class="section-header">
                                <h5 style="color: #2c3e50; margin-bottom: 10px;">ğŸ“‹ ãã®ä»–çµŒè²»</h5>
                                <button type="button" class="add-btn" onclick="addOtherExpense()">â• çµŒè²»é …ç›®ã‚’è¿½åŠ </button>
                            </div>
                            <div id="otherExpensesContainer">
                                <div class="expense-item other-expense-item">
                                    <div class="expense-item-header">
                                        <label>çµŒè²»é …ç›®å</label>
                                        <button type="button" class="remove-btn" onclick="removeOtherExpense(this)" style="display: none;">ğŸ—‘ï¸</button>
                                    </div>
                                    <input type="text" class="other-expense-label" value="ãã®ä»–çµŒè²»" placeholder="é …ç›®åã‚’å…¥åŠ›">
                                    <label>é‡‘é¡</label>
                                    <input type="text" class="other-expense-amount" placeholder="0" value="0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="button" class="calculate-btn" onclick="calculateTotal()">ğŸ“Š é›†è¨ˆå®Ÿè¡Œ</button>
                <button type="button" class="test-btn" onclick="loadTestData()" style="background: #28a745; margin-top: 10px;">ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿</button>
            </div>

            <!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè§£æã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="input-section" style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #e9ecef;">
                <h2 class="section-title">ğŸ“Š ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè§£æ</h2>
                
                <div class="form-group">
                    <label for="spreadsheetData">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘</label>
                    <textarea id="spreadsheetData" placeholder="ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„&#10;ä¾‹ï¼š&#10;2025-07-12 17:43:22	éˆ´æœ¨æ™ºå¼˜	10tomo11yasu@gmail.com	NHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ— åŠå¹´ã‚³ãƒ¼ã‚¹ãƒ»ãƒãƒ¼ãƒãƒ«ãƒ—ãƒ©ãƒ³	univapay	 Â¥ 29,880 	ä¸€å›æ‰•ã„" rows="8" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 6px; font-family: monospace; font-size: 0.9em;"></textarea>
                    <div class="help-text">ã‚¿ãƒ–åŒºåˆ‡ã‚Šã¾ãŸã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã®ãƒ‡ãƒ¼ã‚¿ã«å¯¾å¿œã—ã¦ã„ã¾ã™</div>
                </div>

                <div class="form-group">
                    <label for="dataType">ãƒ‡ãƒ¼ã‚¿å½¢å¼</label>
                    <select id="dataType" style="width: 100%; padding: 8px; border: 2px solid #e9ecef; border-radius: 6px;">
                        <option value="auto">è‡ªå‹•åˆ¤å®š</option>
                        <option value="tab">ã‚¿ãƒ–åŒºåˆ‡ã‚Š</option>
                        <option value="comma">ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Š</option>
                    </select>
                </div>

                <button id="analyzeBtn" style="background: #007bff; color: white; border: none; padding: 12px 25px; border-radius: 6px; font-size: 1em; cursor: pointer; width: 100%; margin-top: 15px; transition: background-color 0.2s ease;">ğŸ” ãƒ‡ãƒ¼ã‚¿ã‚’è§£æ</button>
                
                <div id="analysisResult" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef; display: none;">
                    <h4 style="color: #2c3e50; margin-bottom: 15px;">ğŸ“ˆ è§£æçµæœ</h4>
                    <div id="analysisContent"></div>
                    <button id="applyAnalysisBtn" style="background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 4px; font-size: 0.9em; cursor: pointer; margin-top: 10px;">âœ… å£²ä¸Šã«åæ˜ </button>
                </div>
            </div>
            </div>

            <div class="output-section">
                <h2 class="section-title">ğŸ“‹ é›†è¨ˆçµæœ</h2>
                
                <!-- ã‚µãƒ¼ãƒ“ã‚¹åˆ¥å£²ä¸Šã‚µãƒãƒªãƒ¼ -->
                <div class="summary-card">
                    <h3>ğŸ’° ã‚µãƒ¼ãƒ“ã‚¹åˆ¥å£²ä¸Šå†…è¨³</h3>
                    <div id="salesSummary">
                        <div class="summary-item">
                            <span>ğŸ¢ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å£²ä¸Š</span>
                            <span id="communitySalesAmount">Â¥0</span>
                        </div>
                        <div class="summary-item">
                            <span>ğŸ“ noteå£²ä¸Š</span>
                            <span id="noteSalesAmount">Â¥0</span>
                        </div>
                        <div class="summary-item">
                            <span>ğŸ”¥ å¾¹åº•ç²¾é€²ã‚³ãƒ¼ã‚¹å£²ä¸Š</span>
                            <span id="appSellSalesAmount">Â¥0</span>
                        </div>
                        <div class="summary-item">
                            <span>ğŸš€ NHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—å£²ä¸Š</span>
                            <span id="nhBootcampSalesAmount">Â¥0</span>
                        </div>
                        <div class="summary-item total">
                            <span>å£²ä¸Šåˆè¨ˆ</span>
                            <span id="totalSalesAmount">Â¥0</span>
                        </div>
                    </div>
                </div>

                <!-- ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£è©³ç´° -->
                <div class="summary-card">
                    <h3>ğŸ¢ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£è©³ç´°</h3>
                    <div id="communityDetails">
                        <div class="summary-item">
                            <span>ğŸ“… æœˆé¡ä¼šå“¡</span>
                            <span id="monthlyMembersCount">0å</span>
                        </div>
                        <div class="summary-item">
                            <span>ğŸ“… å¹´é¡ä¼šå“¡</span>
                            <span id="yearlyMembersCount">0å</span>
                        </div>
                        <div class="summary-item">
                            <span>ç·ä¼šå“¡æ•°</span>
                            <span id="totalMembersCount">0å</span>
                        </div>
                        <div class="summary-item">
                            <span>æœˆé¡å˜ä¾¡</span>
                            <span>Â¥22,000</span>
                        </div>
                        <div class="summary-item">
                            <span>å¹´é¡å˜ä¾¡</span>
                            <span>Â¥220,000</span>
                        </div>
                    </div>
                </div>

                <!-- ã‚µãƒ¼ãƒ“ã‚¹åˆ¥çµŒè²»ã‚µãƒãƒªãƒ¼ -->
                <div class="summary-card">
                    <h3>ğŸ’¸ ã‚µãƒ¼ãƒ“ã‚¹åˆ¥çµŒè²»å†…è¨³</h3>
                    <div id="expenseSummary">
                        <div class="summary-item">
                            <span>ğŸ”¥ å¾¹åº•ç²¾é€²ã‚³ãƒ¼ã‚¹çµŒè²»</span>
                            <span id="appSellExpenseAmount">Â¥0</span>
                        </div>
                        <div class="summary-item">
                            <span>ğŸš€ NHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—çµŒè²»</span>
                            <span id="nhBootcampExpenseAmount">Â¥0</span>
                        </div>
                        <div class="summary-item">
                            <span>ğŸ“ noteæ±ºæ¸ˆæ‰‹æ•°æ–™</span>
                            <span id="noteCommissionExpenseAmount">Â¥0</span>
                        </div>
                        <div class="summary-item">
                            <span>ğŸ¢ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ±ºæ¸ˆæ‰‹æ•°æ–™</span>
                            <span id="communityCommissionExpenseAmount">Â¥0</span>
                        </div>
                        <div class="summary-item">
                            <span>ä¼šå ´è²»</span>
                            <span id="venueExpenseAmount">Â¥0</span>
                        </div>
                        <div id="laborExpensesSummary">
                            <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹äººä»¶è²»é …ç›® -->
                        </div>
                        <div class="summary-item">
                            <span>ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°è²»</span>
                            <span id="marketingExpenseAmount">Â¥0</span>
                        </div>
                        <div class="summary-item">
                            <span>ã‚·ã‚¹ãƒ†ãƒ è²»</span>
                            <span id="systemExpenseAmount">Â¥0</span>
                        </div>
                        <div id="otherExpensesSummary">
                            <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ãã®ä»–çµŒè²»é …ç›® -->
                        </div>
                        <div class="summary-item total">
                            <span>çµŒè²»åˆè¨ˆ</span>
                            <span id="totalExpenseAmount">Â¥0</span>
                        </div>
                    </div>
                </div>

                <!-- åæ”¯ã‚µãƒãƒªãƒ¼ -->
                <div class="summary-card">
                    <h3>ğŸ“Š åæ”¯ã‚µãƒãƒªãƒ¼</h3>
                    <div id="profitSummary">
                        <div class="summary-item">
                            <span>å£²ä¸Šåˆè¨ˆ</span>
                            <span id="finalSalesAmount">Â¥0</span>
                        </div>
                        <div class="summary-item">
                            <span>çµŒè²»åˆè¨ˆ</span>
                            <span id="finalExpenseAmount">Â¥0</span>
                        </div>
                        <div class="summary-item total">
                            <span>åˆ©ç›Š</span>
                            <span id="finalProfitAmount">Â¥0</span>
                        </div>
                        <div class="summary-item">
                            <span>åˆ©ç›Šç‡</span>
                            <span id="profitRateAmount">0.00%</span>
                        </div>
                    </div>
                </div>

                <button type="button" class="transfer-btn" onclick="transferToReport()">ğŸ“‹ åæ”¯å ±å‘Šãƒ„ãƒ¼ãƒ«ã«è»¢é€</button>
            </div>
        </div>
    </div>

    <script>
        // å¹´ã®é¸æŠè‚¢ã‚’ç”Ÿæˆ
        function generateYearOptions() {
            const yearSelect = document.getElementById('targetYear');
            const currentYear = new Date().getFullYear();
            
            for (let year = currentYear - 5; year <= currentYear + 2; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year + 'å¹´';
                yearSelect.appendChild(option);
            }
        }

        // ç¾åœ¨ã®å¹´æœˆã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§é¸æŠ
        function setDefaultDate() {
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear();
            const currentMonth = currentDate.getMonth() + 1;
            
            document.getElementById('targetYear').value = currentYear;
            document.getElementById('targetMonth').value = currentMonth;
        }

        // æ•°å€¤ã®ãƒ‘ãƒ¼ã‚¹
        function parseNumber(value) {
            if (!value) return 0;
            return parseInt(value.replace(/[^\d]/g, ''));
        }

        // é‡‘é¡ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatCurrency(amount) {
            return 'Â¥' + amount.toLocaleString();
        }



        // äººä»¶è²»é …ç›®ã‚’è¿½åŠ 
        function addLaborExpense() {
            const container = document.getElementById('laborExpensesContainer');
            const newItem = document.createElement('div');
            newItem.className = 'expense-item labor-expense-item';
            newItem.innerHTML = `
                <div class="expense-item-header">
                    <label>äººä»¶è²»é …ç›®å</label>
                    <button type="button" class="remove-btn" onclick="removeLaborExpense(this)">ğŸ—‘ï¸</button>
                </div>
                <input type="text" class="labor-expense-label" value="äººä»¶è²»" placeholder="é …ç›®åã‚’å…¥åŠ›">
                <label>é‡‘é¡</label>
                <input type="text" class="labor-expense-amount" placeholder="0" value="0">
            `;
            container.appendChild(newItem);
            
            // æ–°ã—ã„å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
            const newInput = newItem.querySelector('.labor-expense-amount');
            newInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^\d]/g, '');
                if (value) {
                    value = parseInt(value).toLocaleString();
                }
                e.target.value = value;
                calculateTotal();
            });
            
            calculateTotal();
        }

        // äººä»¶è²»é …ç›®ã‚’å‰Šé™¤
        function removeLaborExpense(button) {
            const container = document.getElementById('laborExpensesContainer');
            if (container.children.length > 1) {
                button.closest('.labor-expense-item').remove();
                calculateTotal();
            }
        }

        // ãã®ä»–çµŒè²»é …ç›®ã‚’è¿½åŠ 
        function addOtherExpense() {
            const container = document.getElementById('otherExpensesContainer');
            const newItem = document.createElement('div');
            newItem.className = 'expense-item other-expense-item';
            newItem.innerHTML = `
                <div class="expense-item-header">
                    <label>çµŒè²»é …ç›®å</label>
                    <button type="button" class="remove-btn" onclick="removeOtherExpense(this)">ğŸ—‘ï¸</button>
                </div>
                <input type="text" class="other-expense-label" value="çµŒè²»" placeholder="é …ç›®åã‚’å…¥åŠ›">
                <label>é‡‘é¡</label>
                <input type="text" class="other-expense-amount" placeholder="0" value="0">
            `;
            container.appendChild(newItem);
            
            // æ–°ã—ã„å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
            const newInput = newItem.querySelector('.other-expense-amount');
            newInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^\d]/g, '');
                if (value) {
                    value = parseInt(value).toLocaleString();
                }
                e.target.value = value;
                calculateTotal();
            });
            
            calculateTotal();
        }

        // ãã®ä»–çµŒè²»é …ç›®ã‚’å‰Šé™¤
        function removeOtherExpense(button) {
            const container = document.getElementById('otherExpensesContainer');
            if (container.children.length > 1) {
                button.closest('.other-expense-item').remove();
                calculateTotal();
            }
        }

        // ä¼šå“¡æ•°ã®å‚è€ƒè¨ˆç®—ã‚’æ›´æ–°
        function updateMembershipCalculations() {
            // æœˆé¡ä¼šå“¡è¨ˆç®—
            const newMonthlyMembers = parseInt(document.getElementById('newMonthlyMembers').value) || 0;
            const continuingMonthlyMembers = parseInt(document.getElementById('continuingMonthlyMembers').value) || 0;
            const totalMonthlyMembers = newMonthlyMembers + continuingMonthlyMembers;
            const monthlySales = totalMonthlyMembers * 22000; // æœˆé¡2.2ä¸‡å††

            // å¹´é¡ä¼šå“¡è¨ˆç®—
            const newYearlyMembers = parseInt(document.getElementById('newYearlyMembers').value) || 0;
            const existingYearlyMembers = parseInt(document.getElementById('existingYearlyMembers').value) || 0;
            const totalYearlyMembers = newYearlyMembers + existingYearlyMembers;
            const yearlySales = newYearlyMembers * 220000; // å¹´é¡22ä¸‡å††ï¼ˆæ–°è¦ã®ã¿ï¼‰

            const calculatedCommunitySales = monthlySales + yearlySales;
            const totalCommunityMembers = totalMonthlyMembers + totalYearlyMembers;

            // å‚è€ƒæƒ…å ±ã®è¡¨ç¤ºã‚’æ›´æ–°
            document.getElementById('monthlyMembersSalesCalc').textContent = formatCurrency(monthlySales);
            document.getElementById('yearlyMembersSalesCalc').textContent = formatCurrency(yearlySales);
            document.getElementById('totalMembersSalesCalc').textContent = formatCurrency(calculatedCommunitySales);

            return { calculatedCommunitySales, totalCommunityMembers, totalMonthlyMembers, totalYearlyMembers };
        }

        // ç·é›†è¨ˆ
        function calculateTotal() {
            // ä¼šå“¡æ•°ã®å‚è€ƒè¨ˆç®—ã‚’æ›´æ–°
            const membershipData = updateMembershipCalculations();

            // æ‰‹å‹•å…¥åŠ›ã•ã‚ŒãŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å£²ä¸Šã‚’ä½¿ç”¨
            const communitySales = parseNumber(document.getElementById('communitySalesManual').value);
            const totalCommunityMembers = membershipData.totalCommunityMembers;

            // ãã®ä»–ã®å£²ä¸Š
            const noteSales = parseNumber(document.getElementById('noteSales').value);
            const appSellSales = parseNumber(document.getElementById('appSellSales').value);
            const nhBootcampSales = parseNumber(document.getElementById('nhBootcampSales').value);
            const totalSales = communitySales + noteSales + appSellSales + nhBootcampSales;

            // çµŒè²»é›†è¨ˆ
            const appSellStaffExpense = parseNumber(document.getElementById('appSellStaffExpense').value);
            const appSellOtherExpense = parseNumber(document.getElementById('appSellOtherExpense').value);
            const appSellTotalExpense = appSellStaffExpense + appSellOtherExpense;

            const nhBootcampStaffExpense = parseNumber(document.getElementById('nhBootcampStaffExpense').value);
            const nhBootcampOtherExpense = parseNumber(document.getElementById('nhBootcampOtherExpense').value);
            const nhBootcampTotalExpense = nhBootcampStaffExpense + nhBootcampOtherExpense;

            const noteCommissionExpense = parseNumber(document.getElementById('noteCommissionExpense').value);
            const communityCommissionExpense = parseNumber(document.getElementById('communityCommissionExpense').value);
            
            const venueExpense = parseNumber(document.getElementById('venueExpense').value);
            const marketingExpense = parseNumber(document.getElementById('marketingExpense').value);
            const systemExpense = parseNumber(document.getElementById('systemExpense').value);
            
            // å‹•çš„äººä»¶è²»é›†è¨ˆ
            const laborExpenseItems = document.querySelectorAll('.labor-expense-item');
            let totalLaborExpense = 0;
            let laborExpensesSummary = '';
            
            laborExpenseItems.forEach((item, index) => {
                const label = item.querySelector('.labor-expense-label').value || `äººä»¶è²»${index + 1}`;
                const amount = parseNumber(item.querySelector('.labor-expense-amount').value);
                totalLaborExpense += amount;
                if (amount > 0) {
                    laborExpensesSummary += `<div class="summary-item"><span>${label}</span><span>${formatCurrency(amount)}</span></div>`;
                }
            });
            
            // å‹•çš„ãã®ä»–çµŒè²»é›†è¨ˆ
            const otherExpenseItems = document.querySelectorAll('.other-expense-item');
            let totalOtherExpense = 0;
            let otherExpensesSummary = '';
            
            otherExpenseItems.forEach((item, index) => {
                const label = item.querySelector('.other-expense-label').value || `çµŒè²»${index + 1}`;
                const amount = parseNumber(item.querySelector('.other-expense-amount').value);
                totalOtherExpense += amount;
                if (amount > 0) {
                    otherExpensesSummary += `<div class="summary-item"><span>${label}</span><span>${formatCurrency(amount)}</span></div>`;
                }
            });
            
            const totalExpenses = appSellTotalExpense + nhBootcampTotalExpense + noteCommissionExpense + communityCommissionExpense + venueExpense + totalLaborExpense + marketingExpense + systemExpense + totalOtherExpense;

            // åˆ©ç›Šè¨ˆç®—
            const profit = totalSales - totalExpenses;
            const profitRate = totalSales > 0 ? (profit / totalSales) * 100 : 0;

            // è¡¨ç¤ºæ›´æ–°
            document.getElementById('communitySalesAmount').textContent = formatCurrency(communitySales);
            document.getElementById('noteSalesAmount').textContent = formatCurrency(noteSales);
            document.getElementById('appSellSalesAmount').textContent = formatCurrency(appSellSales);
            document.getElementById('nhBootcampSalesAmount').textContent = formatCurrency(nhBootcampSales);
            document.getElementById('totalSalesAmount').textContent = formatCurrency(totalSales);

            document.getElementById('monthlyMembersCount').textContent = membershipData.totalMonthlyMembers + 'å';
            document.getElementById('yearlyMembersCount').textContent = membershipData.totalYearlyMembers + 'å';
            document.getElementById('totalMembersCount').textContent = totalCommunityMembers + 'å';

            document.getElementById('appSellExpenseAmount').textContent = formatCurrency(appSellTotalExpense);
            document.getElementById('nhBootcampExpenseAmount').textContent = formatCurrency(nhBootcampTotalExpense);
            document.getElementById('noteCommissionExpenseAmount').textContent = formatCurrency(noteCommissionExpense);
            document.getElementById('communityCommissionExpenseAmount').textContent = formatCurrency(communityCommissionExpense);
            document.getElementById('venueExpenseAmount').textContent = formatCurrency(venueExpense);
            document.getElementById('laborExpenseAmount').textContent = formatCurrency(laborExpense);
            document.getElementById('marketingExpenseAmount').textContent = formatCurrency(marketingExpense);
            document.getElementById('systemExpenseAmount').textContent = formatCurrency(systemExpense);
            document.getElementById('otherExpenseAmount').textContent = formatCurrency(otherExpense);
            document.getElementById('totalExpenseAmount').textContent = formatCurrency(totalExpenses);

            document.getElementById('finalSalesAmount').textContent = formatCurrency(totalSales);
            document.getElementById('finalExpenseAmount').textContent = formatCurrency(totalExpenses);
            document.getElementById('finalProfitAmount').textContent = formatCurrency(profit);
            document.getElementById('profitRateAmount').textContent = profitRate.toFixed(2) + '%';
        }

        // åæ”¯å ±å‘Šãƒ„ãƒ¼ãƒ«ã«è»¢é€
        function transferToReport() {
            const totalSales = parseNumber(document.getElementById('totalSalesAmount').textContent.replace(/[^\d]/g, ''));
            const totalExpenses = parseNumber(document.getElementById('totalExpenseAmount').textContent.replace(/[^\d]/g, ''));
            
            // ä¼šå“¡æ•°ãƒ‡ãƒ¼ã‚¿ã‚‚ä¿å­˜
            const totalMonthlyMembers = parseInt(document.getElementById('newMonthlyMembers').value) || 0 + parseInt(document.getElementById('continuingMonthlyMembers').value) || 0;
            const totalYearlyMembers = parseInt(document.getElementById('newYearlyMembers').value) || 0 + parseInt(document.getElementById('existingYearlyMembers').value) || 0;
            const totalMembers = totalMonthlyMembers + totalYearlyMembers;
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¸€æ™‚ä¿å­˜
            localStorage.setItem('temp_sales', totalSales);
            localStorage.setItem('temp_expenses', totalExpenses);
            localStorage.setItem('temp_yearlyMembers', totalYearlyMembers);
            localStorage.setItem('temp_regularMembers', totalMonthlyMembers);
            localStorage.setItem('temp_trialMembers', 0); // ä½“é¨“ä¼šå“¡ã¯0ã¨ã—ã¦è¨­å®š
            
            alert('ãƒ‡ãƒ¼ã‚¿ã‚’åæ”¯å ±å‘Šãƒ„ãƒ¼ãƒ«ã«è»¢é€ã—ã¾ã—ãŸã€‚åæ”¯å ±å‘Šãƒ„ãƒ¼ãƒ«ã‚’é–‹ã„ã¦ã€Œãƒ‡ãƒ¼ã‚¿è»¢é€ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚');
        }

        // å…¥åŠ›å€¤ã®è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function addNumberFormatting() {
            const numberInputs = ['communitySalesManual', 'communityCommissionExpense', 'noteSales', 'noteCommissionExpense', 'appSellSales', 'nhBootcampSales', 'appSellStaffExpense', 'appSellOtherExpense', 'nhBootcampStaffExpense', 'nhBootcampOtherExpense', 'venueExpense', 'laborExpense', 'marketingExpense', 'systemExpense', 'otherExpense'];
            
            numberInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', function(e) {
                        let value = e.target.value.replace(/[^\d]/g, '');
                        if (value) {
                            value = parseInt(value).toLocaleString();
                        }
                        e.target.value = value;
                        calculateTotal();
                    });
                }
            });

            // ä¼šå“¡æ•°ã®å…¥åŠ›ç›£è¦–ï¼ˆå‚è€ƒè¨ˆç®—ç”¨ï¼‰
            const memberInputs = ['newMonthlyMembers', 'continuingMonthlyMembers', 'newYearlyMembers', 'existingYearlyMembers'];
            memberInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', function(e) {
                        updateMembershipCalculations();
                    });
                }
            });
        }

        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿æ©Ÿèƒ½
        function loadTestData() {
            const month = document.getElementById('targetMonth').value;
            const testData = getTestData(month);
            
            if (testData) {
                // å¹´æœˆè¨­å®š
                document.getElementById('targetYear').value = testData.year;
                document.getElementById('targetMonth').value = testData.month;
                
                // ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£å£²ä¸Šã¨ä¼šå“¡æ•°
                document.getElementById('communitySalesManual').value = testData.communitySales.toLocaleString();
                document.getElementById('communityCommissionExpense').value = testData.communityCommissionExpense.toLocaleString();
                document.getElementById('newMonthlyMembers').value = testData.newMonthlyMembers;
                document.getElementById('continuingMonthlyMembers').value = testData.continuingMonthlyMembers;
                document.getElementById('newYearlyMembers').value = testData.newYearlyMembers;
                document.getElementById('existingYearlyMembers').value = testData.existingYearlyMembers;
                
                // å£²ä¸Š
                document.getElementById('noteSales').value = testData.noteSales.toLocaleString();
                document.getElementById('appSellSales').value = testData.appSellSales.toLocaleString();
                document.getElementById('nhBootcampSales').value = testData.nhBootcampSales.toLocaleString();
                
                // çµŒè²»
                document.getElementById('appSellStaffExpense').value = testData.appSellStaffExpense.toLocaleString();
                document.getElementById('appSellOtherExpense').value = testData.appSellOtherExpense.toLocaleString();
                document.getElementById('nhBootcampStaffExpense').value = testData.nhBootcampStaffExpense.toLocaleString();
                document.getElementById('nhBootcampOtherExpense').value = testData.nhBootcampOtherExpense.toLocaleString();
                document.getElementById('noteCommissionExpense').value = testData.noteCommissionExpense.toLocaleString();
                document.getElementById('venueExpense').value = testData.venueExpense.toLocaleString();
                document.getElementById('marketingExpense').value = testData.marketingExpense.toLocaleString();
                document.getElementById('systemExpense').value = testData.systemExpense.toLocaleString();
                
                // äººä»¶è²»ï¼ˆæœ€åˆã®é …ç›®ã®ã¿ï¼‰
                const laborItems = document.querySelectorAll('.labor-expense-item');
                if (laborItems.length > 0) {
                    laborItems[0].querySelector('.labor-expense-label').value = 'äººä»¶è²»';
                    laborItems[0].querySelector('.labor-expense-amount').value = testData.laborExpense.toLocaleString();
                }
                
                // ãã®ä»–çµŒè²»ï¼ˆæœ€åˆã®é …ç›®ã®ã¿ï¼‰
                const otherItems = document.querySelectorAll('.other-expense-item');
                if (otherItems.length > 0) {
                    otherItems[0].querySelector('.other-expense-label').value = 'ãã®ä»–çµŒè²»';
                    otherItems[0].querySelector('.other-expense-amount').value = testData.otherExpense.toLocaleString();
                }
                
                // é›†è¨ˆå®Ÿè¡Œ
                calculateTotal();
                
                alert(`${testData.year}å¹´${testData.month}æœˆã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼`);
            } else {
                alert('é¸æŠã•ã‚ŒãŸæœˆã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚2024å¹´12æœˆã€œ2025å¹´4æœˆã®ãƒ‡ãƒ¼ã‚¿ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚');
            }
        }

        // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å®šç¾©
        function getTestData(month) {
            const testData = {
                '12': {
                    year: '2024',
                    month: '12',
                    communitySales: 550000,
                    communityCommissionExpense: 16500,
                    newMonthlyMembers: 5,
                    continuingMonthlyMembers: 0,
                    newYearlyMembers: 2,
                    existingYearlyMembers: 2,
                    noteSales: 85000,
                    appSellSales: 320000,
                    nhBootcampSales: 180000,
                    appSellStaffExpense: 80000,
                    appSellOtherExpense: 40000,
                    nhBootcampStaffExpense: 50000,
                    nhBootcampOtherExpense: 30000,
                    noteCommissionExpense: 8500,
                    venueExpense: 50000,
                    laborExpense: 200000,
                    marketingExpense: 30000,
                    systemExpense: 15000,
                    otherExpense: 25000
                },
                '01': {
                    year: '2025',
                    month: '01',
                    communitySales: 946000,
                    communityCommissionExpense: 28380,
                    newMonthlyMembers: 8,
                    continuingMonthlyMembers: 5,
                    newYearlyMembers: 3,
                    existingYearlyMembers: 5,
                    noteSales: 120000,
                    appSellSales: 450000,
                    nhBootcampSales: 220000,
                    appSellStaffExpense: 100000,
                    appSellOtherExpense: 50000,
                    nhBootcampStaffExpense: 60000,
                    nhBootcampOtherExpense: 35000,
                    noteCommissionExpense: 12000,
                    venueExpense: 55000,
                    laborExpense: 250000,
                    marketingExpense: 40000,
                    systemExpense: 18000,
                    otherExpense: 30000
                },
                '02': {
                    year: '2025',
                    month: '02',
                    communitySales: 1430000,
                    communityCommissionExpense: 42900,
                    newMonthlyMembers: 12,
                    continuingMonthlyMembers: 13,
                    newYearlyMembers: 4,
                    existingYearlyMembers: 8,
                    noteSales: 150000,
                    appSellSales: 520000,
                    nhBootcampSales: 280000,
                    appSellStaffExpense: 120000,
                    appSellOtherExpense: 60000,
                    nhBootcampStaffExpense: 70000,
                    nhBootcampOtherExpense: 40000,
                    noteCommissionExpense: 15000,
                    venueExpense: 60000,
                    laborExpense: 300000,
                    marketingExpense: 50000,
                    systemExpense: 20000,
                    otherExpense: 35000
                },
                '03': {
                    year: '2025',
                    month: '03',
                    communitySales: 1980000,
                    communityCommissionExpense: 59400,
                    newMonthlyMembers: 15,
                    continuingMonthlyMembers: 25,
                    newYearlyMembers: 5,
                    existingYearlyMembers: 13,
                    noteSales: 180000,
                    appSellSales: 580000,
                    nhBootcampSales: 320000,
                    appSellStaffExpense: 140000,
                    appSellOtherExpense: 60000,
                    nhBootcampStaffExpense: 80000,
                    nhBootcampOtherExpense: 45000,
                    noteCommissionExpense: 18000,
                    venueExpense: 65000,
                    laborExpense: 350000,
                    marketingExpense: 60000,
                    systemExpense: 22000,
                    otherExpense: 40000
                },
                '04': {
                    year: '2025',
                    month: '04',
                    communitySales: 2596000,
                    communityCommissionExpense: 77880,
                    newMonthlyMembers: 18,
                    continuingMonthlyMembers: 40,
                    newYearlyMembers: 6,
                    existingYearlyMembers: 19,
                    noteSales: 220000,
                    appSellSales: 650000,
                    nhBootcampSales: 380000,
                    appSellStaffExpense: 160000,
                    appSellOtherExpense: 60000,
                    nhBootcampStaffExpense: 90000,
                    nhBootcampOtherExpense: 50000,
                    noteCommissionExpense: 22000,
                    venueExpense: 70000,
                    laborExpense: 400000,
                    marketingExpense: 70000,
                    systemExpense: 25000,
                    otherExpense: 45000
                }
            };
            
            return testData[month];
        }

        // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆè§£ææ©Ÿèƒ½
        document.getElementById('analyzeBtn').addEventListener('click', function() {
            analyzeSpreadsheetData();
        });

        document.getElementById('applyAnalysisBtn').addEventListener('click', function() {
            applyAnalysisToSales();
        });

        function analyzeSpreadsheetData() {
            const data = document.getElementById('spreadsheetData').value.trim();
            const dataType = document.getElementById('dataType').value;
            
            if (!data) {
                alert('ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            try {
                const lines = data.split('\n').filter(line => line.trim());
                const delimiter = detectDelimiter(data, dataType);
                const parsedData = parseSpreadsheetData(lines, delimiter);
                const analysis = analyzeSalesData(parsedData);
                
                displayAnalysisResult(analysis);
            } catch (error) {
                alert('ãƒ‡ãƒ¼ã‚¿ã®è§£æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        function detectDelimiter(data, dataType) {
            if (dataType === 'tab') return '\t';
            if (dataType === 'comma') return ',';
            
            // è‡ªå‹•åˆ¤å®š
            const firstLine = data.split('\n')[0];
            const tabCount = (firstLine.match(/\t/g) || []).length;
            const commaCount = (firstLine.match(/,/g) || []).length;
            
            return tabCount > commaCount ? '\t' : ',';
        }

        function parseSpreadsheetData(lines, delimiter) {
            const parsedData = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const columns = line.split(delimiter);
                if (columns.length < 6) continue; // æœ€ä½6åˆ—å¿…è¦
                
                // é‡‘é¡åˆ—ã‚’æ¢ã™ï¼ˆÂ¥è¨˜å·ã‚’å«ã‚€åˆ—ï¼‰
                let amountIndex = -1;
                for (let j = 0; j < columns.length; j++) {
                    if (columns[j].includes('Â¥') || columns[j].includes('å††')) {
                        amountIndex = j;
                        break;
                    }
                }
                
                if (amountIndex === -1) continue;
                
                // é‡‘é¡ã‚’æŠ½å‡ºã—ã¦æ•°å€¤ã«å¤‰æ›
                const amountStr = columns[amountIndex].replace(/[Â¥,\s]/g, '');
                const amount = parseInt(amountStr);
                
                if (isNaN(amount)) continue;
                
                parsedData.push({
                    date: columns[0] || '',
                    name: columns[1] || '',
                    email: columns[2] || '',
                    product: columns[3] || '',
                    paymentMethod: columns[4] || '',
                    amount: amount,
                    paymentType: columns[6] || '',
                    originalLine: line
                });
            }
            
            return parsedData;
        }

        function analyzeSalesData(data) {
            const totalSales = data.reduce((sum, item) => sum + item.amount, 0);
            const transactionCount = data.length;
            
            // å•†å“åˆ¥é›†è¨ˆ
            const productSummary = {};
            data.forEach(item => {
                const product = item.product || 'ä¸æ˜';
                if (!productSummary[product]) {
                    productSummary[product] = { count: 0, amount: 0 };
                }
                productSummary[product].count++;
                productSummary[product].amount += item.amount;
            });
            
            // æ±ºæ¸ˆæ–¹æ³•åˆ¥é›†è¨ˆ
            const paymentSummary = {};
            data.forEach(item => {
                const method = item.paymentMethod || 'ä¸æ˜';
                if (!paymentSummary[method]) {
                    paymentSummary[method] = { count: 0, amount: 0 };
                }
                paymentSummary[method].count++;
                paymentSummary[method].amount += item.amount;
            });
            
            // NHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—é–¢é€£ã®å£²ä¸Šã‚’ç‰¹å®š
            const nhBootcampSales = data
                .filter(item => item.product && item.product.includes('NHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—'))
                .reduce((sum, item) => sum + item.amount, 0);
            
            // ãã®ä»–ã®å£²ä¸Šï¼ˆNHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—ä»¥å¤–ï¼‰
            const otherSales = totalSales - nhBootcampSales;
            
            return {
                totalSales,
                transactionCount,
                productSummary,
                paymentSummary,
                nhBootcampSales,
                otherSales,
                rawData: data
            };
        }

        function displayAnalysisResult(analysis) {
            const resultDiv = document.getElementById('analysisResult');
            const contentDiv = document.getElementById('analysisContent');
            
            let html = `
                <div style="margin-bottom: 15px;">
                    <strong>ç·å£²ä¸Š:</strong> Â¥${analysis.totalSales.toLocaleString()}<br>
                    <strong>å–å¼•ä»¶æ•°:</strong> ${analysis.transactionCount}ä»¶
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>å•†å“åˆ¥é›†è¨ˆ:</strong>
                    <ul style="margin: 5px 0; padding-left: 20px;">
            `;
            
            Object.entries(analysis.productSummary).forEach(([product, data]) => {
                html += `<li>${product}: ${data.count}ä»¶ Ã— Â¥${data.amount.toLocaleString()}</li>`;
            });
            
            html += `
                    </ul>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>æ±ºæ¸ˆæ–¹æ³•åˆ¥é›†è¨ˆ:</strong>
                    <ul style="margin: 5px 0; padding-left: 20px;">
            `;
            
            Object.entries(analysis.paymentSummary).forEach(([method, data]) => {
                html += `<li>${method}: ${data.count}ä»¶ Ã— Â¥${data.amount.toLocaleString()}</li>`;
            });
            
            html += `
                    </ul>
                </div>
                
                <div style="margin-bottom: 15px; padding: 10px; background: #e8f5e8; border-radius: 4px;">
                    <strong>æ¨å¥¨è¨­å®š:</strong><br>
                    <strong>NHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—å£²ä¸Š:</strong> Â¥${analysis.nhBootcampSales.toLocaleString()}<br>
                    <strong>ãã®ä»–å£²ä¸Š:</strong> Â¥${analysis.otherSales.toLocaleString()}
                </div>
            `;
            
            contentDiv.innerHTML = html;
            resultDiv.style.display = 'block';
            
            // è§£æçµæœã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ä¿å­˜
            window.currentAnalysis = analysis;
        }

        function applyAnalysisToSales() {
            if (!window.currentAnalysis) {
                alert('å…ˆã«ãƒ‡ãƒ¼ã‚¿ã‚’è§£æã—ã¦ãã ã•ã„');
                return;
            }
            
            const analysis = window.currentAnalysis;
            
            // NHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—å£²ä¸Šã‚’è¨­å®š
            document.getElementById('nhBootcampSales').value = analysis.nhBootcampSales.toLocaleString();
            
            // ãã®ä»–ã®å£²ä¸Šã‚’é©åˆ‡ãªé …ç›®ã«è¨­å®šï¼ˆä¾‹ï¼šå¾¹åº•ç²¾é€²ã‚³ãƒ¼ã‚¹ï¼‰
            if (analysis.otherSales > 0) {
                document.getElementById('appSellSales').value = analysis.otherSales.toLocaleString();
            }
            
            // è‡ªå‹•ã§é›†è¨ˆã‚’å®Ÿè¡Œ
            calculateTotal();
            
            alert(`å£²ä¸Šãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã¾ã—ãŸï¼\n\nNHãƒ–ãƒ¼ãƒˆã‚­ãƒ£ãƒ³ãƒ—: Â¥${analysis.nhBootcampSales.toLocaleString()}\nãã®ä»–: Â¥${analysis.otherSales.toLocaleString()}`);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateYearOptions();
            setDefaultDate();
            addNumberFormatting();
        });
    </script>
</body>
</html>
