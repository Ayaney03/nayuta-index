#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ç®¡ç†ã‚·ãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«
ã‚ã‚„ã­ãˆå°‚ç”¨ - ãƒœã‚¿ãƒ³ã²ã¨ã¤ã§ç§’é€Ÿä½œæˆ
"""

import os
from datetime import datetime
import json

class ArchiveSheetGenerator:
    def __init__(self):
        self.template = self._get_template()
    
    def _get_template(self):
        """ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ç®¡ç†ã‚·ãƒ¼ãƒˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ§‹é€ """
        return {
            "basic_info": {
                "title": "",
                "date": "",
                "speakers": "",
                "participants": "",
                "duration": "",
                "format": "",
                "location": ""
            },
            "overview": {
                "main_theme": "",
                "target_audience": [],
                "learning_objectives": []
            },
            "transcript_sections": [],
            "youtube_info": {
                "title_suggestions": [],
                "thumbnail_keywords": [],
                "description_template": ""
            },
            "quotes": [],
            "content_ideas": {
                "blog_articles": [],
                "line_distribution": [],
                "note_articles": [],
                "course_content": []
            },
            "checklist": {
                "transcript": [],
                "youtube_prep": [],
                "secondary_use": []
            },
            "memo": "",
            "related_files": []
        }
    
    def generate_sheet(self, **kwargs):
        """
        ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ç®¡ç†ã‚·ãƒ¼ãƒˆã‚’ç”Ÿæˆ
        
        Args:
            title: ã‚»ãƒŸãƒŠãƒ¼ã‚¿ã‚¤ãƒˆãƒ«
            date: é–‹å‚¬æ—¥æ™‚
            speakers: è¬›å¸«å
            url: éŒ²ç”»URL
            duration: éŒ²ç”»æ™‚é–“
            main_theme: ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ
            target_audience: å¯¾è±¡è€…ï¼ˆãƒªã‚¹ãƒˆï¼‰
            learning_objectives: å­¦ç¿’ç›®æ¨™ï¼ˆãƒªã‚¹ãƒˆï¼‰
            **kwargs: ãã®ä»–ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        """
        
        # åŸºæœ¬æƒ…å ±ã®è¨­å®š
        basic_info = {
            "title": kwargs.get("title", ""),
            "date": kwargs.get("date", datetime.now().strftime("%Yå¹´%mæœˆ%dæ—¥")),
            "speakers": kwargs.get("speakers", ""),
            "participants": kwargs.get("participants", ""),
            "duration": kwargs.get("duration", ""),
            "format": kwargs.get("format", "YouTubeå‹•ç”»"),
            "location": kwargs.get("url", "")
        }
        
        # Markdownãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
        content = self._generate_markdown(basic_info, **kwargs)
        
        # ãƒ•ã‚¡ã‚¤ãƒ«åç”Ÿæˆ
        safe_title = self._sanitize_filename(kwargs.get("title", "ã‚»ãƒŸãƒŠãƒ¼"))
        filename = f"{safe_title}_ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ç®¡ç†ã‚·ãƒ¼ãƒˆ.md"
        
        # ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
        filepath = os.path.join("/Users/ayakamizuno/cursor", filename)
        
        with open(filepath, "w", encoding="utf-8") as f:
            f.write(content)
        
        return filepath
    
    def _generate_markdown(self, basic_info, **kwargs):
        """Markdownã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆ"""
        
        content = f"""# ã‚»ãƒŸãƒŠãƒ¼ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ç®¡ç†ã‚·ãƒ¼ãƒˆ

## ğŸ“ åŸºæœ¬æƒ…å ±

| é …ç›® | å†…å®¹ |
|------|------|
| ã‚»ãƒŸãƒŠãƒ¼ã‚¿ã‚¤ãƒˆãƒ« | {basic_info['title']} |
| é–‹å‚¬æ—¥æ™‚ | {basic_info['date']} |
| è¬›å¸« | {basic_info['speakers']} |
| å‚åŠ è€…æ•° | {basic_info['participants']} |
| éŒ²ç”»æ™‚é–“ | {basic_info['duration']} |
| ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ | {basic_info['format']} |
| ä¿å­˜å ´æ‰€ | {basic_info['location']} |

---

## ğŸ¯ ã‚»ãƒŸãƒŠãƒ¼æ¦‚è¦

### ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ
```
{kwargs.get('main_theme', 'ãƒ¡ã‚¤ãƒ³ãƒ†ãƒ¼ãƒã‚’è¨˜å…¥ã—ã¦ãã ã•ã„')}
```

### å¯¾è±¡è€…
```
{self._format_list(kwargs.get('target_audience', ['å¯¾è±¡è€…ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„']))}
```

### å­¦ç¿’ç›®æ¨™
{self._format_objectives(kwargs.get('learning_objectives', ['å­¦ç¿’ç›®æ¨™ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„']))}

---

## ğŸ“‹ æ–‡å­—èµ·ã“ã—

### å°å…¥éƒ¨åˆ†ï¼ˆ0:00-XX:XXï¼‰
```
ãƒ»å°å…¥å†…å®¹ã‚’è¨˜å…¥
ãƒ»é‡è¦ãƒã‚¤ãƒ³ãƒˆã‚’ç®‡æ¡æ›¸ã
ãƒ»å°è±¡çš„ãªç™ºè¨€
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š**
- ãƒã‚¤ãƒ³ãƒˆ1
- ãƒã‚¤ãƒ³ãƒˆ2
- ãƒã‚¤ãƒ³ãƒˆ3

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³2ï¼ˆXX:XX-XX:XXï¼‰
```
ãƒ»ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…å®¹ã‚’è¨˜å…¥
ãƒ»é‡è¦ãƒã‚¤ãƒ³ãƒˆã‚’ç®‡æ¡æ›¸ã
ãƒ»å…·ä½“çš„ãªäº‹ä¾‹
```

**é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š**
- ãƒã‚¤ãƒ³ãƒˆ1
- ãƒã‚¤ãƒ³ãƒˆ2
- ãƒã‚¤ãƒ³ãƒˆ3

---

## ğŸ¬ YouTubeæ´»ç”¨æƒ…å ±

### å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«æ¡ˆ
1. ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€‘ãƒ¡ã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«
2. ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€‘ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«
3. ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€‘åˆ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³

### ã‚µãƒ ãƒã‚¤ãƒ«ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰1
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰2
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰3
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰4

### æ¦‚è¦æ¬„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```
ğŸ¥{basic_info['title']}

â–¶ï¸ ã“ã®å‹•ç”»ï¼ˆéŸ³å£°ï¼‰ã«ã¤ã„ã¦
ã‚»ãƒŸãƒŠãƒ¼ã®æ¦‚è¦èª¬æ˜ã‚’ã“ã“ã«è¨˜å…¥

âœ”ï¸ å­¦ã¹ã‚‹ã“ã¨1
âœ”ï¸ å­¦ã¹ã‚‹ã“ã¨2
âœ”ï¸ å­¦ã¹ã‚‹ã“ã¨3

â–¶ï¸ ã“ã®å‹•ç”»ã§å­¦ã¹ã‚‹ã“ã¨

âœ… ãƒã‚¤ãƒ³ãƒˆ1ã®è©³ç´°èª¬æ˜
âœ… ãƒã‚¤ãƒ³ãƒˆ2ã®è©³ç´°èª¬æ˜
âœ… ãƒã‚¤ãƒ³ãƒˆ3ã®è©³ç´°èª¬æ˜

â° ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
00:00 å°å…¥
XX:XX ã‚»ã‚¯ã‚·ãƒ§ãƒ³1
XX:XX ã‚»ã‚¯ã‚·ãƒ§ãƒ³2
XX:XX ã¾ã¨ã‚

ğŸ“š é–¢é€£ãƒªãƒ³ã‚¯
ãƒ»é–¢é€£ãƒªãƒ³ã‚¯1
ãƒ»é–¢é€£ãƒªãƒ³ã‚¯2

ğŸ’¡ è¬›å¸«ã«ã¤ã„ã¦
ã€{basic_info['speakers']}ã€‘
ãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±
ãƒ»å®Ÿç¸¾
ãƒ»å°‚é–€åˆ†é‡

ğŸ·ï¸ #ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°1 #ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°2 #ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°3
```

---

## ğŸ’ åè¨€ãƒ»å°è±¡çš„ãªãƒ•ãƒ¬ãƒ¼ã‚º

### å¼•ç”¨å¯èƒ½ãªåè¨€
1. "åè¨€1ã‚’ã“ã“ã«è¨˜å…¥"
2. "åè¨€2ã‚’ã“ã“ã«è¨˜å…¥"
3. "åè¨€3ã‚’ã“ã“ã«è¨˜å…¥"

### SNSæŠ•ç¨¿ç”¨ã‚·ãƒ§ãƒ¼ãƒˆã‚¯ãƒªãƒƒãƒ—å€™è£œ
| æ™‚é–“ | å†…å®¹ | æŠ•ç¨¿æ–‡æ¡ˆ |
|------|------|----------|
| XX:XX-XX:XX | ã‚¯ãƒªãƒƒãƒ—å†…å®¹1 | ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€‘æŠ•ç¨¿æ–‡æ¡ˆ1 |
| XX:XX-XX:XX | ã‚¯ãƒªãƒƒãƒ—å†…å®¹2 | ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€‘æŠ•ç¨¿æ–‡æ¡ˆ2 |
| XX:XX-XX:XX | ã‚¯ãƒªãƒƒãƒ—å†…å®¹3 | ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€‘æŠ•ç¨¿æ–‡æ¡ˆ3 |

---

## ğŸ“Š ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å±•é–‹ã‚¢ã‚¤ãƒ‡ã‚¢

### ãƒ–ãƒ­ã‚°è¨˜äº‹åŒ–
- [ ] è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«ï¼šã‚¿ã‚¤ãƒˆãƒ«æ¡ˆ
- [ ] æ§‹æˆæ¡ˆï¼šæ§‹æˆã®æ¦‚è¦
- [ ] å…¬é–‹äºˆå®šæ—¥ï¼šæ—¥ä»˜

### LINEé…ä¿¡æ´»ç”¨
- [ ] é…ä¿¡ã‚¿ã‚¤ãƒˆãƒ«ï¼šã‚¿ã‚¤ãƒˆãƒ«æ¡ˆ
- [ ] é…ä¿¡å†…å®¹ï¼šå†…å®¹ã®æ¦‚è¦
- [ ] é…ä¿¡äºˆå®šæ—¥ï¼šæ—¥ä»˜

### noteè¨˜äº‹åŒ–
- [ ] noteã‚¿ã‚¤ãƒˆãƒ«ï¼šã‚¿ã‚¤ãƒˆãƒ«æ¡ˆ
- [ ] ä¾¡æ ¼è¨­å®šï¼šä¾¡æ ¼
- [ ] å…¬é–‹äºˆå®šæ—¥ï¼šæ—¥ä»˜

### è¬›åº§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åŒ–
- [ ] ãƒ¬ãƒƒã‚¹ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ï¼šã‚¿ã‚¤ãƒˆãƒ«æ¡ˆ
- [ ] å¯¾è±¡è¬›åº§ï¼šè¬›åº§å
- [ ] è¿½åŠ äºˆå®šæ—¥ï¼šæ—¥ä»˜

---

## âœ… ä½œæ¥­ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### æ–‡å­—èµ·ã“ã—ä½œæ¥­
- [ ] éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™
- [ ] AIãƒ„ãƒ¼ãƒ«ã§ã®ä¸€æ¬¡èµ·ã“ã—
- [ ] æ‰‹å‹•ã§ã®æ ¡æ­£ãƒ»ç·¨é›†
- [ ] é‡è¦ãƒã‚¤ãƒ³ãƒˆã®æŠ½å‡º
- [ ] ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã®è¿½åŠ 

### YouTubeæº–å‚™
- [ ] å‹•ç”»ç·¨é›†
- [ ] ã‚µãƒ ãƒã‚¤ãƒ«ä½œæˆ
- [ ] æ¦‚è¦æ¬„ä½œæˆ
- [ ] ã‚¿ã‚¤ãƒˆãƒ«æ±ºå®š
- [ ] å…¬é–‹è¨­å®š

### äºŒæ¬¡æ´»ç”¨
- [ ] ãƒ–ãƒ­ã‚°è¨˜äº‹ä½œæˆ
- [ ] SNSæŠ•ç¨¿æº–å‚™
- [ ] LINEé…ä¿¡æº–å‚™
- [ ] è¬›åº§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„åŒ–

---

## ğŸ“ ãƒ¡ãƒ¢ãƒ»ãã®ä»–

```
ãƒ»ç‰¹è¨˜äº‹é …ã‚„ãƒ¡ãƒ¢ã‚’ã“ã“ã«è¨˜å…¥
ãƒ»æ”¹å–„ç‚¹ã‚„æ°—ã¥ã
ãƒ»æ¬¡å›ã¸ã®ç”³ã—é€ã‚Šäº‹é …
```

---

## ğŸ”— é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒªãƒ³ã‚¯

- éŒ²ç”»ãƒ•ã‚¡ã‚¤ãƒ«ï¼š{basic_info['location']}
- è³‡æ–™ãƒ•ã‚¡ã‚¤ãƒ«ï¼šï¼ˆè¿½åŠ äºˆå®šï¼‰
- YouTube URLï¼šï¼ˆå…¬é–‹å¾Œè¿½åŠ ï¼‰
- ãƒ–ãƒ­ã‚°è¨˜äº‹URLï¼šï¼ˆä½œæˆäºˆå®šï¼‰
- é–¢é€£ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼šï¼ˆé–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«åï¼‰

---

## ğŸ“„ æ–‡å­—èµ·ã“ã—åŸæ–‡

```
ï¼ˆæ–‡å­—èµ·ã“ã—åŸæ–‡ã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ï¼‰
```
"""
        return content
    
    def _format_list(self, items):
        """ãƒªã‚¹ãƒˆã‚’æ–‡å­—åˆ—å½¢å¼ã«å¤‰æ›"""
        if isinstance(items, list):
            return '\n'.join([f"ãƒ»{item}" for item in items])
        return str(items)
    
    def _format_objectives(self, objectives):
        """å­¦ç¿’ç›®æ¨™ã‚’Markdownå½¢å¼ã«å¤‰æ›"""
        if isinstance(objectives, list):
            return '\n'.join([f"- {obj}" for obj in objectives])
        return f"- {objectives}"
    
    def _sanitize_filename(self, filename):
        """ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å®‰å…¨ãªå½¢å¼ã«å¤‰æ›"""
        # ä½¿ç”¨ã§ããªã„æ–‡å­—ã‚’ç½®æ›
        invalid_chars = ['/', '\\', ':', '*', '?', '"', '<', '>', '|']
        for char in invalid_chars:
            filename = filename.replace(char, '_')
        
        # é•·ã™ãã‚‹å ´åˆã¯çŸ­ç¸®
        if len(filename) > 50:
            filename = filename[:50]
        
        return filename

def main():
    """ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œé–¢æ•°"""
    generator = ArchiveSheetGenerator()
    
    # ã‚µãƒ³ãƒ—ãƒ«å®Ÿè¡Œ
    sample_data = {
        "title": "ã‚µãƒ³ãƒ—ãƒ«ã‚»ãƒŸãƒŠãƒ¼",
        "date": "2025å¹´1æœˆ15æ—¥",
        "speakers": "ã‚ã‚„ã­ãˆ",
        "participants": "20å",
        "duration": "ç´„60åˆ†",
        "url": "https://example.com/video",
        "main_theme": "AIã‚’æ´»ç”¨ã—ãŸåŠ¹ç‡çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹ç¯‰è¡“",
        "target_audience": [
            "AIæ´»ç”¨ã«èˆˆå‘³ãŒã‚ã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ã‚½ãƒ³",
            "åŠ¹ç‡åŒ–ã‚’æ±‚ã‚ã‚‹èµ·æ¥­å®¶ãƒ»ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹",
            "ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ¯ãƒ¼ã‚¯ã§åå…¥ã‚’ä¸Šã’ãŸã„äºº"
        ],
        "learning_objectives": [
            "AIãƒ„ãƒ¼ãƒ«ã®å®Ÿè·µçš„ãªæ´»ç”¨æ–¹æ³•ã‚’å­¦ã¶",
            "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®åŠ¹ç‡åŒ–æ‰‹æ³•ã‚’èº«ã«ã¤ã‘ã‚‹",
            "ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ¯ãƒ¼ã‚¯ã§ã®æˆæœå‘ä¸Šã‚’å®Ÿç¾ã™ã‚‹"
        ]
    }
    
    filepath = generator.generate_sheet(**sample_data)
    print(f"ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ç®¡ç†ã‚·ãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ: {filepath}")

if __name__ == "__main__":
    main()

